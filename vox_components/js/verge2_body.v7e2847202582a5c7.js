(function(a){a.fn.redraw=function(){return a(this).each(function(){var b=document.createTextNode(" ");a(this).append(b);setTimeout(function(){b.parentNode.removeChild(b)},0)})}})(jQuery);(function(b,a){var c=b(a);b.fn.lazyload=function(e){var h=this;var i;var g={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:a,data_attribute:"original",skip_invisible:true,appear:null,load:null,scrollInterval:200,resizeInterval:250};function d(n,m){if(typeof _!=="undefined"){return _.debounce(n,m)}else{return n}}function l(){var m=0;h.each(function(){var n=b(this);if(g.skip_invisible&&!n.is(":visible")){return}if(b.abovethetop(this,g)||b.leftofbegin(this,g)){}else{if(!b.belowthefold(this,g)&&!b.rightoffold(this,g)){n.trigger("lazyload:appear")}else{if(++m>g.failure_limit){return false}}}})}if(e){if(undefined!==e.failurelimit){e.failure_limit=e.failurelimit;delete e.failurelimit}if(undefined!==e.effectspeed){e.effect_speed=e.effectspeed;delete e.effectspeed}b.extend(g,e)}i=(g.container===undefined||g.container===a)?c:b(g.container);if(0===g.event.indexOf("scroll")){var j=function(m){return l()};i.bind(g.event,d(j,g.scrollInterval))}this.each(function(){var o=this;var s=b(o);o.loaded=false;o.error_event_set=false;var m=4000,r=4,p=0;var n=function(){if(!this.loaded){if(g.appear){var v=h.length;g.appear.call(o,v,g)}if(this.tagName==="IMG"){b("<img />").bind("load",function(){s.hide().attr("src",s.data(g.data_attribute))[g.effect](g.effect_speed);o.loaded=true;var w=b.grep(h,function(y){return !y.loaded});h=b(w);if(g.load){var x=h.length;g.load.call(o,x,g)}}).bind("error",function(){if(!o.error_event_set){a.setTimeout(b.proxy(q,this),m)}o.error_event_set=true}).attr("src",s.data(g.data_attribute))}else{s.css("background-image","url('"+s.data(g.data_attribute)+"')")[g.effect](g.effect_speed);o.loaded=true;var u=b.grep(h,function(w){return !w.loaded});h=b(u);if(g.load){var v=h.length;g.load.call(o,v,g)}}}};var q=function(){p+=1;if(p<=r){b(this).bind("error",function(){a.setTimeout(b.proxy(q,this),m)});var u=this.src.split("?")[0];this.src=u+"?"+new Date().getTime()}};s.one("lazyload:appear",n);if(0!==g.event.indexOf("scroll")){var t=function(u){if(!o.loaded){s.trigger("lazyload:appear")}};s.bind(g.event,d(t,g.scrollInterval))}});var f=function(m){l()};c.bind("resize",d(f,g.resizeInterval));l();return this};b.belowthefold=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.height()+c.scrollTop()}else{d=b(f.container).offset().top+b(f.container).height()}return d<=b(e).offset().top-f.threshold};b.rightoffold=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.width()+c.scrollLeft()}else{d=b(f.container).offset().left+b(f.container).width()}return d<=b(e).offset().left-f.threshold};b.abovethetop=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.scrollTop()}else{d=b(f.container).offset().top}return d>=b(e).offset().top+f.threshold+b(e).height()};b.leftofbegin=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.scrollLeft()}else{d=b(f.container).offset().left}return d>=b(e).offset().left+f.threshold+b(e).width()};b.inviewport=function(d,e){return !b.rightofscreen(d,e)&&!b.leftofscreen(d,e)&&!b.belowthefold(d,e)&&!b.abovethetop(d,e)};b.extend(b.expr[":"],{"below-the-fold":function(d){return b.belowthefold(d,{threshold:0})},"above-the-top":function(d){return !b.belowthefold(d,{threshold:0})},"right-of-screen":function(d){return b.rightoffold(d,{threshold:0})},"left-of-screen":function(d){return !b.rightoffold(d,{threshold:0})},"in-viewport":function(d){return !b.inviewport(d,{threshold:0})},"above-the-fold":function(d){return !b.belowthefold(d,{threshold:0})},"right-of-fold":function(d){return b.rightoffold(d,{threshold:0})},"left-of-fold":function(d){return !b.rightoffold(d,{threshold:0})}})})(jQuery,window);
/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(f){var a=/\+/g;function d(i){return b.raw?i:encodeURIComponent(i)}function g(i){return b.raw?i:decodeURIComponent(i)}function h(i){return d(b.json?JSON.stringify(i):String(i))}function c(i){if(i.indexOf('"')===0){i=i.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{i=decodeURIComponent(i.replace(a," "));return b.json?JSON.parse(i):i}catch(j){}}function e(j,i){var l=b.raw?j:c(j);return f.isFunction(i)?i(l):l}var b=f.cookie=function(r,q,w){if(q!==undefined&&!f.isFunction(q)){w=f.extend({},b.defaults,w);if(typeof w.expires==="number"){var s=w.expires,v=w.expires=new Date();v.setDate(v.getDate()+s)}return(document.cookie=[d(r),"=",h(q),w.expires?"; expires="+w.expires.toUTCString():"",w.path?"; path="+w.path:"",w.domain?"; domain="+w.domain:"",w.secure?"; secure":""].join(""))}var x=r?undefined:{};var u=document.cookie?document.cookie.split("; "):[];for(var p=0,n=u.length;p<n;p++){var o=u[p].split("=");var j=g(o.shift());var m=o.join("=");if(r&&r===j){x=e(m,q);break}if(!r&&(m=e(m))!==undefined){x[j]=m}}return x};b.defaults={};f.removeCookie=function(j,i){if(f.cookie(j)===undefined){return false}f.cookie(j,"",f.extend({},i,{expires:-1}));return !f.cookie(j)}})(jQuery);(function(b,d){if(b.rails!==d){b.error("jquery-ujs has already been loaded!")}var a;var c=b(document);b.rails=a={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",buttonClickSelector:"button[data-remote], button[data-confirm]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(f){var e=b('meta[name="csrf-token"]').attr("content");if(e){f.setRequestHeader("X-CSRF-Token",e)}},refreshCSRFTokens:function(){var e=b("meta[name=csrf-token]").attr("content");var f=b("meta[name=csrf-param]").attr("content");b('form input[name="'+f+'"]').val(e)},fire:function(h,e,g){var f=b.Event(e);h.trigger(f,g);return f.result!==false},confirm:function(e){return confirm(e)},ajax:function(e){return b.ajax(e)},href:function(e){return e.attr("href")},handleRemote:function(j){var e,f,i,n,g,h,m,o;if(a.fire(j,"ajax:before")){n=j.data("cross-domain");g=n===d?null:n;h=j.data("with-credentials")||null;m=j.data("type")||(b.ajaxSettings&&b.ajaxSettings.dataType);if(j.is("form")){e=j.attr("method");f=j.attr("action");i=j.serializeArray();var l=j.data("ujs:submit-button");if(l){i.push(l);j.data("ujs:submit-button",null)}}else{if(j.is(a.inputChangeSelector)){e=j.data("method");f=j.data("url");i=j.serialize();if(j.data("params")){i=i+"&"+j.data("params")}}else{if(j.is(a.buttonClickSelector)){e=j.data("method")||"get";f=j.data("url");i=j.serialize();if(j.data("params")){i=i+"&"+j.data("params")}}else{e=j.data("method");f=a.href(j);i=j.data("params")||null}}}o={type:e||"GET",data:i,dataType:m,beforeSend:function(q,p){if(p.dataType===d){q.setRequestHeader("accept","*/*;q=0.5, "+p.accepts.script)}if(a.fire(j,"ajax:beforeSend",[q,p])){j.trigger("ajax:send",q)}else{return false}},success:function(q,p,r){j.trigger("ajax:success",[q,p,r])},complete:function(q,p){j.trigger("ajax:complete",[q,p])},error:function(r,p,q){j.trigger("ajax:error",[r,p,q])},crossDomain:g};if(h){o.xhrFields={withCredentials:h}}if(f){o.url=f}return a.ajax(o)}else{return false}},handleMethod:function(j){var g=a.href(j),m=j.data("method"),l=j.attr("target"),e=b("meta[name=csrf-token]").attr("content"),h=b("meta[name=csrf-param]").attr("content"),i=b('<form method="post" action="'+g+'"></form>'),f='<input name="_method" value="'+m+'" type="hidden" />';if(h!==d&&e!==d){f+='<input name="'+h+'" value="'+e+'" type="hidden" />'}if(l){i.attr("target",l)}i.hide().append(f).appendTo("body");i.submit()},disableFormElements:function(e){e.find(a.disableSelector).each(function(){var f=b(this),g=f.is("button")?"html":"val";f.data("ujs:enable-with",f[g]());f[g](f.data("disable-with"));f.prop("disabled",true)})},enableFormElements:function(e){e.find(a.enableSelector).each(function(){var f=b(this),g=f.is("button")?"html":"val";if(f.data("ujs:enable-with")){f[g](f.data("ujs:enable-with"))}f.prop("disabled",false)})},allowAction:function(e){var f=e.data("confirm"),g=false,h;if(!f){return true}if(a.fire(e,"confirm")){g=a.confirm(f);h=a.fire(e,"confirm:complete",[g])}return g&&h},blankInputs:function(l,h,j){var g=b(),i,f,e=h||"input,textarea",m=l.find(e);m.each(function(){i=b(this);f=i.is("input[type=checkbox],input[type=radio]")?i.is(":checked"):i.val();if(!f===!j){if(i.is("input[type=radio]")&&m.filter('input[type=radio]:checked[name="'+i.attr("name")+'"]').length){return true}g=g.add(i)}});return g.length?g:false},nonBlankInputs:function(f,e){return a.blankInputs(f,e,true)},stopEverything:function(f){b(f.target).trigger("ujs:everythingStopped");f.stopImmediatePropagation();return false},disableElement:function(e){e.data("ujs:enable-with",e.html());e.html(e.data("disable-with"));e.bind("click.railsDisable",function(f){return a.stopEverything(f)})},enableElement:function(e){if(e.data("ujs:enable-with")!==d){e.html(e.data("ujs:enable-with"));e.removeData("ujs:enable-with")}e.unbind("click.railsDisable")}};if(a.fire(c,"rails:attachBindings")){b.ajaxPrefilter(function(e,g,f){if(!e.crossDomain){a.CSRFProtection(f)}});c.delegate(a.linkDisableSelector,"ajax:complete",function(){a.enableElement(b(this))});c.delegate(a.linkClickSelector,"click.rails",function(j){var h=b(this),l=h.data("method"),i=h.data("params"),g=j.metaKey||j.ctrlKey;if(!a.allowAction(h)){return a.stopEverything(j)}if(!g&&h.is(a.linkDisableSelector)){a.disableElement(h)}if(h.data("remote")!==d){if(g&&(!l||l==="GET")&&!i){return true}var f=a.handleRemote(h);if(f===false){a.enableElement(h)}else{f.error(function(){a.enableElement(h)})}return false}else{if(h.data("method")){a.handleMethod(h);return false}}});c.delegate(a.buttonClickSelector,"click.rails",function(g){var f=b(this);if(!a.allowAction(f)){return a.stopEverything(g)}a.handleRemote(f);return false});c.delegate(a.inputChangeSelector,"change.rails",function(g){var f=b(this);if(!a.allowAction(f)){return a.stopEverything(g)}a.handleRemote(f);return false});c.delegate(a.formSubmitSelector,"submit.rails",function(l){var h=b(this),j=h.data("remote")!==d,g,f;if(!a.allowAction(h)){return a.stopEverything(l)}if(h.attr("novalidate")==d){g=a.blankInputs(h,a.requiredInputSelector);if(g&&a.fire(h,"ajax:aborted:required",[g])){return a.stopEverything(l)}}if(j){f=a.nonBlankInputs(h,a.fileInputSelector);if(f){setTimeout(function(){a.disableFormElements(h)},13);var i=a.fire(h,"ajax:aborted:file",[f]);if(!i){setTimeout(function(){a.enableFormElements(h)},13)}return i}a.handleRemote(h);return false}else{setTimeout(function(){a.disableFormElements(h)},13)}});c.delegate(a.formInputClickSelector,"click.rails",function(g){var f=b(this);if(!a.allowAction(f)){return a.stopEverything(g)}var e=f.attr("name"),h=e?{name:e,value:f.val()}:null;f.closest("form").data("ujs:submit-button",h)});c.delegate(a.formSubmitSelector,"ajax:send.rails",function(e){if(this==e.target){a.disableFormElements(b(this))}});c.delegate(a.formSubmitSelector,"ajax:complete.rails",function(e){if(this==e.target){a.enableFormElements(b(this))}});b(function(){a.refreshCSRFTokens()})}})(jQuery);if(window._!=undefined){_.templateSettings={interpolate:/\[\%\=(.+?)\%\]/g,escape:/\[\%\-(.+?)\%\]/g,evaluate:/\[\%(.+?)\%\]/g,variable:"data"}}var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(d){var b={};d(document).ready(function(){Chorus.DynamicSizedImages.init()});var f=".vox-lazy-load";var a="lazy-loaded";var e="lazy-loading";function c(g,j){var h={failure_limit:20,load:function(){var q=d(this),o=q.parent(".image-window");if(q.is("img")){if(o.length>0){q.css({position:"absolute",top:Math.round((o.outerHeight()-q.outerHeight())/2),left:Math.round((o.outerWidth()-q.outerWidth())/2)});if(typeof q.attr("height")==="undefined"){q.css("height","auto")}}else{if(typeof q.attr("height")==="undefined"){q.css("height","auto")}}}q.addClass(a);q.removeClass(e);q.removeClass("m-chorus-asset__in-entry-body");if(d.fn.playGIF){var p={};if(Chorus.Context&&Chorus.Context.main_link_color){p.circleBackgroundColor=Chorus.Context.main_link_color;p.circleTextColor="FFFFFF"}if(typeof PLAYGIF_DISABLE_FLAG==="undefined"){var n=d('.m-entry__body img[src*=".gif"], .m-block__fanshot-media img[src*=".gif"]');var r=d('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');if((n.length+r.length)===1){PLAYGIF_DISABLE_FLAG=true}else{PLAYGIF_DISABLE_FLAG=false;n.playGIF(p)}}q.playGIF(p)}},threshold:800};if(j){d.extend(h,j)}var g=g||d("body");var i=g.find(f+":visible").not("."+e,"."+a);var l=[];var m=[];i.each(function(w,r){var t=d(this);var u=t.data("imgkey");var o=t.data("chorus-asset-id");if(typeof u!=="undefined"){if(h.parentDimensionSlc){var q=t.closest(h.parentDimensionSlc);var n=q.outerWidth();var x=q.outerHeight()}if(!n){n=t.outerWidth()}if(!x){x=t.outerHeight()}if(t.is("img")){var s=t.data("ratio"),v=t.parent(".image-window");if(typeof s!=="undefined"&&s>0){x=Math.ceil(n/s)}if(v.length>0){n=Math.ceil(v.outerWidth());x=Math.ceil(v.outerHeight())}if(x>0){t.css("height",x)}}if(typeof window.devicePixelRatio!=="undefined"){n=Math.ceil(n*window.devicePixelRatio);x=Math.ceil(x*window.devicePixelRatio)}var p=u+":"+n+"x"+x;l.push(p);t.attr("data-dim",n+"x"+x);t.addClass(e)}else{if(typeof o!=="undefined"){var n=t.outerWidth();var x=t.outerHeight();if(t.is("img")){var s=t.data("ratio"),v=t.parent(".image-window");if(typeof s!=="undefined"&&s>0){x=Math.ceil(n/s)}if(v.length>0){n=Math.ceil(v.outerWidth());x=Math.ceil(v.outerHeight())}if(x>0){t.css("height",x)}}if(typeof window.devicePixelRatio!=="undefined"){n=Math.ceil(n*window.devicePixelRatio);x=Math.ceil(x*window.devicePixelRatio)}m.push(o+":"+n+":"+x);t.addClass(e)}else{t.lazyload(h)}}});if(l.length===0&&m.length===0){return}d.each([m,l],function(n,o){o.sort(function(q,p){return +q.split(":")[0]-+p.split(":")[0]})});d.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",data:{imgkeys:l.join(","),asset_keys:m.join(",")},success:function(n){var o=n.urls;i.each(function(){var r=d(this);var q;if(r.data("imgkey")){q=r.data("imgkey")+":"+r.data("dim")}else{q=r.data("chorus-asset-id")}var p=o[q];if(typeof p!=="undefined"){r.attr("data-original",p);r.lazyload(h)}})}})}b.init=function(){if(Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading){Chorus.Context.defer_image_loading=false}else{this.initUI()}if(Chorus.EventDispatcher){Chorus.EventDispatcher.subscribe("moduleInserted",function(g){c(g.modules)})}};b.initUI=function(g,h){c(g,h)};b.applyTo=function(g,h){c(g,h)};return b}(jQuery);var Chorus=Chorus||{};Chorus.EventDispatcher=function(){var i={};var h={};var b=Util.getUrlVars()["debugEventDispatcher"]==true;var e=Util.getUrlVars()["debugVerbose"]==true;function g(j){if(_){return _.clone(j)}return JSON.parse(JSON.stringify(jsonObject))}function d(m,j,l){if(!m[j]){m[j]=[]}m[j].push(l)}function f(m,p,l){var p=p||{};var o=i[m];if(b){console.log("Chorus.EventDispatcher is publishing the following event",m,p)}if(l){if(b){console.log("Chorus.EventDispatcher event "+m+" should be applied to all subsequent events",m,p)}d(h,m,p)}if(!i[m]){return}p.eventType=m;for(var n=0,j=o.length;n<j;n++){o[n](g(p))}}function a(l,n){d(i,l,n);if(b&&!e){console.log("Chorus.EventDispatcher is subscribing to the following event",l)}if(b&&e){console.log("Chorus.EventDispatcher is subscribing to the following event",l,n)}var o=h[l];if(o){for(var m=0,j=o.length;m<j;m++){if(b){console.log("Chorus.EventDispatcher has found an event of the type "+l+" that should be applied to any subsequent subscriber",l,o[m])}n(o[m])}}}function c(j,n){if(!i[j]){return}var l=i[j];for(var m=l.length-1;m>-1;m--){if(l[m]==n){l.splice(m,1)}}}return{publish:function(l,m,j){var j=j||false;f(l,m,j)},subscribe:function(j,l){a(j,l)},unsubscribe:function(j,l){c(j,l)},debug:function(j){b=true;if(j===true){e=true}}}}();var Chorus=Chorus||{};Chorus.EditoriallyManagedCell=(function(c,h){var g={edit:"/editorially_managed_cells/handle_edit",update:"/editorially_managed_cells/handle_update",preview:"/editorially_managed_cells/preview",show_live:"/editorially_managed_cells/refresh",help:"/editorially_managed_cells/help"};var d=null;function a(p){var q={};var m=p.serializeArray();for(var n=m.length-1;n>-1;n--){q[m[n].name]=m[n].value}return q}function e(m){alert("There was an error updating this cell. Please check your URL and/or that all fields are completed.")}function b(m){m.preventDefault();var n=c(m.currentTarget);f(n.closest(".chorus-emc__admin"),n.data("emc-action"))}function i(n){n.preventDefault();var o=c(n.currentTarget);var m=o.closest("form");f(c('.chorus-emc__admin[data-emc-slug="'+m.data("emc-slug")+'"]'),"update",_.extend(a(m),{button_action:o.data("emc-action")}))}function f(m,o,q){var q=_.extend({slug:m.data("emc-slug"),bucket:m.data("emc-bucket")},q);var p=g[o];q;if(o==="edit"||o==="help"){Chorus.EventDispatcher.publish("modal_open",{method:n,url:p,data:q})}else{var n=(o=="update")?"POST":"GET";j(m);c.ajax({method:n,url:p,data:q,success:function(s){Chorus.EventDispatcher.publish("modal_close");var r=c('.chorus-emc__content[data-emc-slug="'+m.data("emc-slug")+'"]');if(r.length>0){r.replaceWith(s)}},error:e})}}function j(m){c(m).find(".chorus-emc__content").html("Loading...")}function l(){c(h).on("click",".chorus-emc__admin *[data-emc-action]",b);c(h).on("click",".chorus-emc__form *[data-emc-action]",i)}return{init:l,urls:g}})(jQuery,document);jQuery(function(){Chorus.EditoriallyManagedCell.init()});var Chorus=Chorus||{};Chorus.Tooltip=(function(e){var d="tooltip-text";var c="tooltip-class";var a=function(h){h.preventDefault();if(!e(this).data("tooltip-shown")){b(e(this))}return false};var b=function(j){var o=j.data(d);var i=j.data(c)||"tooltip";var l="tool-tip-"+Math.round(Math.random()*1000);j.data("tooltip-shown",l);var m=j.offset().top+j.height();var h=j.offset().left;var n=e("<span id='"+l+"' data-is-tooltip class='"+i+"'>"+o+"</span>");n.on("click",g);n.css({top:m,left:h,position:"absolute"});if(Util.UserAgentProfiler.isMobile()){n.css({left:0})}e(document.body).prepend(n);setTimeout(function(){n.addClass("shown")},200)};var g=function(j){var h=e(this).data("tooltip-shown")||e(this).filter("is-tooltip").attr("id");if(h){var i=e("#"+h);e(this).removeData("tooltip-shown");i.removeClass("shown");setTimeout(function(){i.remove()},1000)}};var f=function(h){e(h).not("*[data-tooltip-shown]").on("click",a);e(h).not("*[data-tooltip-shown]").on("mouseover",a);e(h).on("mouseout",g)};return{attachTo:f}})(jQuery);jQuery(function(){Chorus.Tooltip.attachTo("*[data-tooltip-text]")});function FastClick(f,c){var g;c=c||{};this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=c.touchBoundary||10;this.layer=f;this.tapDelay=c.tapDelay||200;if(FastClick.notNeeded(f)){return}function h(j,i){return function(){return j.apply(i,arguments)}}var b=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"];var e=this;for(var d=0,a=b.length;d<a;d++){e[b[d]]=h(e[b[d]],e)}if(deviceIsAndroid){f.addEventListener("mouseover",this.onMouse,true);f.addEventListener("mousedown",this.onMouse,true);f.addEventListener("mouseup",this.onMouse,true)}f.addEventListener("click",this.onClick,true);f.addEventListener("touchstart",this.onTouchStart,false);f.addEventListener("touchmove",this.onTouchMove,false);f.addEventListener("touchend",this.onTouchEnd,false);f.addEventListener("touchcancel",this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){f.removeEventListener=function(j,m,i){var l=Node.prototype.removeEventListener;if(j==="click"){l.call(f,j,m.hijacked||m,i)}else{l.call(f,j,m,i)}};f.addEventListener=function(l,m,j){var i=Node.prototype.addEventListener;if(l==="click"){i.call(f,l,m.hijacked||(m.hijacked=function(n){if(!n.propagationStopped){m(n)}}),j)}else{i.call(f,l,m,j)}}}if(typeof f.onclick==="function"){g=f.onclick;f.addEventListener("click",function(i){g(i)},false);f.onclick=null}}var deviceIsAndroid=navigator.userAgent.indexOf("Android")>0;var deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);var deviceIsIOS4=deviceIsIOS&&(/OS 4_\d(_\d)?/).test(navigator.userAgent);var deviceIsIOSWithBadTarget=deviceIsIOS&&(/OS ([6-9]|\d{2})_\d/).test(navigator.userAgent);var deviceIsBlackBerry10=navigator.userAgent.indexOf("BB10")>0;FastClick.prototype.needsClick=function(a){switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled){return true}break;case"input":if((deviceIsIOS&&a.type==="file")||a.disabled){return true}break;case"label":case"video":return true}return(/\bneedsclick\b/).test(a.className)};FastClick.prototype.needsFocus=function(a){switch(a.nodeName.toLowerCase()){case"textarea":return true;case"select":return !deviceIsAndroid;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return !a.disabled&&!a.readOnly;default:return(/\bneedsfocus\b/).test(a.className)}};FastClick.prototype.sendClick=function(b,c){var a,d;if(document.activeElement&&document.activeElement!==b){document.activeElement.blur()}d=c.changedTouches[0];a=document.createEvent("MouseEvents");a.initMouseEvent(this.determineEventType(b),true,true,window,1,d.screenX,d.screenY,d.clientX,d.clientY,false,false,false,false,0,null);a.forwardedTouchEvent=true;b.dispatchEvent(a)};FastClick.prototype.determineEventType=function(a){if(deviceIsAndroid&&a.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};FastClick.prototype.focus=function(a){var b;if(deviceIsIOS&&a.setSelectionRange&&a.type.indexOf("date")!==0&&a.type!=="time"){b=a.value.length;a.setSelectionRange(b,b)}else{a.focus()}};FastClick.prototype.updateScrollParent=function(b){var c,a;c=b.fastClickScrollParent;if(!c||!c.contains(b)){a=b;do{if(a.scrollHeight>a.offsetHeight){c=a;b.fastClickScrollParent=a;break}a=a.parentElement}while(a)}if(c){c.fastClickLastScrollTop=c.scrollTop}};FastClick.prototype.getTargetElementFromEventTarget=function(a){if(a.nodeType===Node.TEXT_NODE){return a.parentNode}return a};FastClick.prototype.onTouchStart=function(c){var a,d,b;if(c.targetTouches.length>1){return true}a=this.getTargetElementFromEventTarget(c.target);d=c.targetTouches[0];if(deviceIsIOS){b=window.getSelection();if(b.rangeCount&&!b.isCollapsed){return true}if(!deviceIsIOS4){if(d.identifier&&d.identifier===this.lastTouchIdentifier){c.preventDefault();return false}this.lastTouchIdentifier=d.identifier;this.updateScrollParent(a)}}this.trackingClick=true;this.trackingClickStart=c.timeStamp;this.targetElement=a;this.touchStartX=d.pageX;this.touchStartY=d.pageY;if((c.timeStamp-this.lastClickTime)<this.tapDelay){c.preventDefault()}return true};FastClick.prototype.touchHasMoved=function(a){var c=a.changedTouches[0],b=this.touchBoundary;if(Math.abs(c.pageX-this.touchStartX)>b||Math.abs(c.pageY-this.touchStartY)>b){return true}return false};FastClick.prototype.onTouchMove=function(a){if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(a.target)||this.touchHasMoved(a)){this.trackingClick=false;this.targetElement=null}return true};FastClick.prototype.findControl=function(a){if(a.control!==undefined){return a.control}if(a.htmlFor){return document.getElementById(a.htmlFor)}return a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};FastClick.prototype.onTouchEnd=function(c){var e,d,b,g,f,a=this.targetElement;if(!this.trackingClick){return true}if((c.timeStamp-this.lastClickTime)<this.tapDelay){this.cancelNextClick=true;return true}this.cancelNextClick=false;this.lastClickTime=c.timeStamp;d=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(deviceIsIOSWithBadTarget){f=c.changedTouches[0];a=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||a;a.fastClickScrollParent=this.targetElement.fastClickScrollParent}b=a.tagName.toLowerCase();if(b==="label"){e=this.findControl(a);if(e){this.focus(a);if(deviceIsAndroid){return false}a=e}}else{if(this.needsFocus(a)){if((c.timeStamp-d)>100||(deviceIsIOS&&window.top!==window&&b==="input")){this.targetElement=null;return false}this.focus(a);this.sendClick(a,c);if(!deviceIsIOS||b!=="select"){this.targetElement=null;c.preventDefault()}return false}}if(deviceIsIOS&&!deviceIsIOS4){g=a.fastClickScrollParent;if(g&&g.fastClickLastScrollTop!==g.scrollTop){return true}}if(!this.needsClick(a)){c.preventDefault();this.sendClick(a,c)}return false};FastClick.prototype.onTouchCancel=function(){this.trackingClick=false;this.targetElement=null};FastClick.prototype.onMouse=function(a){if(!this.targetElement){return true}if(a.forwardedTouchEvent){return true}if(!a.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(a.stopImmediatePropagation){a.stopImmediatePropagation()}else{a.propagationStopped=true}a.stopPropagation();a.preventDefault();return false}return true};FastClick.prototype.onClick=function(a){var b;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(a.target.type==="submit"&&a.detail===0){return true}b=this.onMouse(a);if(!b){this.targetElement=null}return b};FastClick.prototype.destroy=function(){var a=this.layer;if(deviceIsAndroid){a.removeEventListener("mouseover",this.onMouse,true);a.removeEventListener("mousedown",this.onMouse,true);a.removeEventListener("mouseup",this.onMouse,true)}a.removeEventListener("click",this.onClick,true);a.removeEventListener("touchstart",this.onTouchStart,false);a.removeEventListener("touchmove",this.onTouchMove,false);a.removeEventListener("touchend",this.onTouchEnd,false);a.removeEventListener("touchcancel",this.onTouchCancel,false)};FastClick.notNeeded=function(b){var a;var d;var c;if(typeof window.ontouchstart==="undefined"){return true}d=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(d){if(deviceIsAndroid){a=document.querySelector("meta[name=viewport]");if(a){if(a.content.indexOf("user-scalable=no")!==-1){return true}if(d>31&&document.documentElement.scrollWidth<=window.outerWidth){return true}}}else{return true}}if(deviceIsBlackBerry10){c=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(c[1]>=10&&c[2]>=3){a=document.querySelector("meta[name=viewport]");if(a){if(a.content.indexOf("user-scalable=no")!==-1){return true}if(document.documentElement.scrollWidth<=window.outerWidth){return true}}}}if(b.style.msTouchAction==="none"){return true}return false};FastClick.attach=function(b,a){return new FastClick(b,a)};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return FastClick})}else{if(typeof module!=="undefined"&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick}else{window.FastClick=FastClick}}
/*! Hammer.JS - v1.1.3 - 2014-05-20
 * http://eightmedia.github.io/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
(function(U,m){var H=function H(am,al){return new H.Instance(am,al||{})};H.VERSION="1.1.3";H.defaults={behavior:{userSelect:"none",touchAction:"pan-y",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};H.DOCUMENT=document;H.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled;H.HAS_TOUCHEVENTS=("ontouchstart" in U);H.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent);H.NO_MOUSEEVENTS=(H.HAS_TOUCHEVENTS&&H.IS_MOBILE)||H.HAS_POINTEREVENTS;H.CALCULATE_INTERVAL=25;var L={};var D=H.DIRECTION_DOWN="down";var z=H.DIRECTION_LEFT="left";var ad=H.DIRECTION_UP="up";var J=H.DIRECTION_RIGHT="right";var ab=H.POINTER_MOUSE="mouse";var c=H.POINTER_TOUCH="touch";var t=H.POINTER_PEN="pen";var s=H.EVENT_START="start";var G=H.EVENT_MOVE="move";var x=H.EVENT_END="end";var l=H.EVENT_RELEASE="release";var O=H.EVENT_TOUCH="touch";H.READY=false;H.plugins=H.plugins||{};H.gestures=H.gestures||{};function f(){if(H.READY){return}Q.determineEventTypes();R.each(H.gestures,function(al){o.register(al)});Q.onTouch(H.DOCUMENT,G,o.detect);Q.onTouch(H.DOCUMENT,x,o.detect);H.READY=true}var R=H.utils={extend:function j(al,an,ao){for(var am in an){if(!an.hasOwnProperty(am)||(al[am]!==m&&ao)){continue}al[am]=an[am]}return al},on:function K(al,an,am){al.addEventListener(an,am,false)},off:function V(al,an,am){al.removeEventListener(an,am,false)},each:function Z(ap,ao,an){var am,al;if("forEach" in ap){ap.forEach(ao,an)}else{if(ap.length!==m){for(am=0,al=ap.length;am<al;am++){if(ao.call(an,ap[am],am,ap)===false){return}}}else{for(am in ap){if(ap.hasOwnProperty(am)&&ao.call(an,ap[am],am,ap)===false){return}}}}},inStr:function T(am,al){return am.indexOf(al)>-1},inArray:function af(ap,ao){if(ap.indexOf){var am=ap.indexOf(ao);return(am===-1)?false:am}else{for(var an=0,al=ap.length;an<al;an++){if(ap[an]===ao){return an}}return false}},toArray:function A(al){return Array.prototype.slice.call(al,0)},hasParent:function ae(am,al){while(am){if(am==al){return true}am=am.parentNode}return false},getCenter:function I(ar){var ap=[],an=[],aq=[],ao=[],am=Math.min,al=Math.max;if(ar.length===1){return{pageX:ar[0].pageX,pageY:ar[0].pageY,clientX:ar[0].clientX,clientY:ar[0].clientY}}R.each(ar,function(at){ap.push(at.pageX);an.push(at.pageY);aq.push(at.clientX);ao.push(at.clientY)});return{pageX:(am.apply(Math,ap)+al.apply(Math,ap))/2,pageY:(am.apply(Math,an)+al.apply(Math,an))/2,clientX:(am.apply(Math,aq)+al.apply(Math,aq))/2,clientY:(am.apply(Math,ao)+al.apply(Math,ao))/2}},getVelocity:function a(an,am,al){return{x:Math.abs(am/an)||0,y:Math.abs(al/an)||0}},getAngle:function q(an,am){var al=am.clientX-an.clientX,ao=am.clientY-an.clientY;return Math.atan2(ao,al)*180/Math.PI},getDirection:function n(an,am){var al=Math.abs(an.clientX-am.clientX),ao=Math.abs(an.clientY-am.clientY);if(al>=ao){return an.clientX-am.clientX>0?z:J}return an.clientY-am.clientY>0?ad:D},getDistance:function p(an,am){var al=am.clientX-an.clientX,ao=am.clientY-an.clientY;return Math.sqrt((al*al)+(ao*ao))},getScale:function F(am,al){if(am.length>=2&&al.length>=2){return this.getDistance(al[0],al[1])/this.getDistance(am[0],am[1])}return 1},getRotation:function B(am,al){if(am.length>=2&&al.length>=2){return this.getAngle(al[1],al[0])-this.getAngle(am[1],am[0])}return 0},isVertical:function P(al){return al==ad||al==D},setPrefixedCss:function ag(an,ar,ap,al){var ao=["","Webkit","Moz","O","ms"];ar=R.toCamelCase(ar);for(var am=0;am<ao.length;am++){var aq=ar;if(ao[am]){aq=ao[am]+aq.slice(0,1).toUpperCase()+aq.slice(1)}if(aq in an.style){an.style[aq]=(al==null||al)&&ap||"";break}}},toggleBehavior:function S(an,ao,am){if(!ao||!an||!an.style){return}R.each(ao,function(ap,aq){R.setPrefixedCss(an,aq,ap,am)});var al=am&&function(){return false};if(ao.userSelect=="none"){an.onselectstart=al}if(ao.userDrag=="none"){an.ondragstart=al}},toCamelCase:function v(al){return al.replace(/[_-]([a-z])/g,function(am){return am[1].toUpperCase()})}};var Q=H.event={preventMouseEvents:false,started:false,shouldDetect:false,on:function K(am,ao,an,ap){var al=ao.split(" ");R.each(al,function(aq){R.on(am,aq,an);ap&&ap(aq)})},off:function V(am,ao,an,ap){var al=ao.split(" ");R.each(al,function(aq){R.off(am,aq,an);ap&&ap(aq)})},onTouch:function N(an,am,ao){var al=this;var ap=function ap(au){var av=au.type.toLowerCase(),aq=H.HAS_POINTEREVENTS,at=R.inStr(av,"mouse"),ar;if(at&&al.preventMouseEvents){return}else{if(at&&am==s&&au.button===0){al.preventMouseEvents=false;al.shouldDetect=true}else{if(aq&&am==s){al.shouldDetect=(au.buttons===1||d.matchType(c,au))}else{if(!at&&am==s){al.preventMouseEvents=true;al.shouldDetect=true}}}}if(aq&&am!=x){d.updatePointer(am,au)}if(al.shouldDetect){ar=al.doDetect.call(al,au,am,an,ao)}if(ar==x){al.preventMouseEvents=false;al.shouldDetect=false;d.reset()}if(aq&&am==x){d.updatePointer(am,au)}};this.on(an,L[am],ap);return ap},doDetect:function ai(ar,am,ap,au){var al=this.getTouchList(ar,am);var av=al.length;var an=am;var ao=al.trigger;var at=av;if(am==s){ao=O}else{if(am==x){ao=l;at=al.length-((ar.changedTouches)?ar.changedTouches.length:1)}}if(at>0&&this.started){an=G}this.started=true;var aq=this.collectEventData(ap,an,al,ar);if(am!=x){au.call(o,aq)}if(ao){aq.changedLength=at;aq.eventType=ao;au.call(o,aq);aq.eventType=an;delete aq.changedLength}if(an==x){au.call(o,aq);this.started=false}return an},determineEventTypes:function aa(){var al;if(H.HAS_POINTEREVENTS){if(U.PointerEvent){al=["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]}else{al=["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]}}else{if(H.NO_MOUSEEVENTS){al=["touchstart","touchmove","touchend touchcancel"]}else{al=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"]}}L[s]=al[0];L[G]=al[1];L[x]=al[2];return L},getTouchList:function w(ao,an){if(H.HAS_POINTEREVENTS){return d.getTouchList()}if(ao.touches){if(an==G){return ao.touches}var al=[];var ap=[].concat(R.toArray(ao.touches),R.toArray(ao.changedTouches));var am=[];R.each(ap,function(aq){if(R.inArray(al,aq.identifier)===false){am.push(aq)}al.push(aq.identifier)});return am}ao.identifier=1;return[ao]},collectEventData:function aj(an,am,ap,ao){var al=c;if(R.inStr(ao.type,"mouse")||d.matchType(ab,ao)){al=ab}else{if(d.matchType(t,ao)){al=t}}return{center:R.getCenter(ap),timeStamp:Date.now(),target:ao.target,touches:ap,eventType:am,pointerType:al,srcEvent:ao,preventDefault:function(){var aq=this.srcEvent;aq.preventManipulation&&aq.preventManipulation();aq.preventDefault&&aq.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return o.stopDetect()}}}};var d=H.PointerEvent={pointers:{},getTouchList:function w(){var al=[];R.each(this.pointers,function(am){al.push(am)});return al},updatePointer:function Y(al,am){if(al==x||(al!=x&&am.buttons!==1)){delete this.pointers[am.pointerId]}else{am.identifier=am.pointerId;this.pointers[am.pointerId]=am}},matchType:function X(al,an){if(!an.pointerType){return false}var ao=an.pointerType,am={};am[ab]=(ao===(an.MSPOINTER_TYPE_MOUSE||ab));am[c]=(ao===(an.MSPOINTER_TYPE_TOUCH||c));am[t]=(ao===(an.MSPOINTER_TYPE_PEN||t));return am[al]},reset:function y(){this.pointers={}}};var o=H.detection={gestures:[],current:null,previous:null,stopped:false,startDetect:function M(am,al){if(this.current){return}this.stopped=false;this.current={inst:am,startEvent:R.extend({},al),lastEvent:false,lastCalcEvent:false,futureCalcEvent:false,lastCalcData:{},name:""};this.detect(al)},detect:function u(am){if(!this.current||this.stopped){return}am=this.extendEventData(am);var an=this.current.inst,ao=an.options;R.each(this.gestures,function al(ap){if(!this.stopped&&an.enabled&&ao[ap.name]){ap.handler.call(ap,am,an)}},this);if(this.current){this.current.lastEvent=am}if(am.eventType==x){this.stopDetect()}return am},stopDetect:function b(){this.previous=R.extend({},this.current);this.current=null;this.stopped=true},getCalculatedData:function i(at,am,ar,ap,ao){var au=this.current,aq=false,an=au.lastCalcEvent,al=au.lastCalcData;if(an&&at.timeStamp-an.timeStamp>H.CALCULATE_INTERVAL){am=an.center;ar=at.timeStamp-an.timeStamp;ap=at.center.clientX-an.center.clientX;ao=at.center.clientY-an.center.clientY;aq=true}if(at.eventType==O||at.eventType==l){au.futureCalcEvent=at}if(!au.lastCalcEvent||aq){al.velocity=R.getVelocity(ar,ap,ao);al.angle=R.getAngle(am,at.center);al.direction=R.getDirection(am,at.center);au.lastCalcEvent=au.futureCalcEvent||at;au.futureCalcEvent=at}at.velocityX=al.velocity.x;at.velocityY=al.velocity.y;at.interimAngle=al.angle;at.interimDirection=al.direction},extendEventData:function E(ap){var ar=this.current,aq=ar.startEvent,ao=ar.lastEvent||aq;if(ap.eventType==O||ap.eventType==l){aq.touches=[];R.each(ap.touches,function(at){aq.touches.push({clientX:at.clientX,clientY:at.clientY})})}var an=ap.timeStamp-aq.timeStamp,am=ap.center.clientX-aq.center.clientX,al=ap.center.clientY-aq.center.clientY;this.getCalculatedData(ap,ao.center,an,am,al);R.extend(ap,{startEvent:aq,deltaTime:an,deltaX:am,deltaY:al,distance:R.getDistance(aq.center,ap.center),angle:R.getAngle(aq.center,ap.center),direction:R.getDirection(aq.center,ap.center),scale:R.getScale(aq.touches,ap.touches),rotation:R.getRotation(aq.touches,ap.touches)});return ap},register:function g(am){var al=am.defaults||{};if(al[am.name]===m){al[am.name]=true}R.extend(H.defaults,al,true);am.index=am.index||1000;this.gestures.push(am);this.gestures.sort(function(ao,an){if(ao.index<an.index){return -1}if(ao.index>an.index){return 1}return 0});return this.gestures}};H.Instance=function(an,am){var al=this;f();this.element=an;this.enabled=true;R.each(am,function(ap,ao){delete am[ao];am[R.toCamelCase(ao)]=ap});this.options=R.extend(R.extend({},H.defaults),am||{});if(this.options.behavior){R.toggleBehavior(this.element,this.options.behavior,true)}this.eventStartHandler=Q.onTouch(an,s,function(ao){if(al.enabled&&ao.eventType==s){o.startDetect(al,ao)}else{if(ao.eventType==O){o.detect(ao)}}});this.eventHandlers=[]};H.Instance.prototype={on:function W(an,am){var al=this;Q.on(al.element,an,am,function(ao){al.eventHandlers.push({gesture:ao,handler:am})});return al},off:function r(an,am){var al=this;Q.off(al.element,an,am,function(ap){var ao=R.inArray({gesture:ap,handler:am});if(ao!==false){al.eventHandlers.splice(ao,1)}});return al},trigger:function ac(am,ao){if(!ao){ao={}}var an=H.DOCUMENT.createEvent("Event");an.initEvent(am,true,true);an.gesture=ao;var al=this.element;if(R.hasParent(ao.target,al)){al=ao.target}al.dispatchEvent(an);return this},enable:function e(al){this.enabled=al;return this},dispose:function C(){var al,am;R.toggleBehavior(this.element,this.options.behavior,false);for(al=-1;(am=this.eventHandlers[++al]);){R.off(this.element,am.gesture,am.handler)}this.eventHandlers=[];Q.off(this.element,L[s],this.eventStartHandler);return null}};(function(am){var al=false;function an(ar,at){var av=o.current;if(at.options.dragMaxTouches>0&&ar.touches.length>at.options.dragMaxTouches){return}switch(ar.eventType){case s:al=false;break;case G:if(ar.distance<at.options.dragMinDistance&&av.name!=am){return}var ao=av.startEvent.center;if(av.name!=am){av.name=am;if(at.options.dragDistanceCorrection&&ar.distance>0){var ap=Math.abs(at.options.dragMinDistance/ar.distance);ao.pageX+=ar.deltaX*ap;ao.pageY+=ar.deltaY*ap;ao.clientX+=ar.deltaX*ap;ao.clientY+=ar.deltaY*ap;ar=o.extendEventData(ar)}}if(av.lastEvent.dragLockToAxis||(at.options.dragLockToAxis&&at.options.dragLockMinDistance<=ar.distance)){ar.dragLockToAxis=true}var aq=av.lastEvent.direction;if(ar.dragLockToAxis&&aq!==ar.direction){if(R.isVertical(aq)){ar.direction=(ar.deltaY<0)?ad:D}else{ar.direction=(ar.deltaX<0)?z:J}}if(!al){at.trigger(am+"start",ar);al=true}at.trigger(am,ar);at.trigger(am+ar.direction,ar);var au=R.isVertical(ar.direction);if((at.options.dragBlockVertical&&au)||(at.options.dragBlockHorizontal&&!au)){ar.preventDefault()}break;case l:if(al&&ar.changedLength<=at.options.dragMaxTouches){at.trigger(am+"end",ar);al=false}break;case x:al=false;break}}H.gestures.Drag={name:am,index:50,handler:an,defaults:{dragMinDistance:10,dragDistanceCorrection:true,dragMaxTouches:1,dragBlockHorizontal:false,dragBlockVertical:false,dragLockToAxis:false,dragLockMinDistance:25}}})("drag");H.gestures.Gesture={name:"gesture",index:1337,handler:function ah(al,am){am.trigger(this.name,al)}};(function(al){var an;function am(ap,aq){var ao=aq.options,ar=o.current;switch(ap.eventType){case s:clearTimeout(an);ar.name=al;an=setTimeout(function(){if(ar&&ar.name==al){aq.trigger(al,ap)}},ao.holdTimeout);break;case G:if(ap.distance>ao.holdThreshold){clearTimeout(an)}break;case l:clearTimeout(an);break}}H.gestures.Hold={name:al,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:am}})("hold");H.gestures.Release={name:"release",index:Infinity,handler:function ah(al,am){if(al.eventType==l){am.trigger(this.name,al)}}};H.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:0.6,swipeVelocityY:0.6},handler:function ak(am,an){if(am.eventType==l){var ao=am.touches.length,al=an.options;if(ao<al.swipeMinTouches||ao>al.swipeMaxTouches){return}if(am.velocityX>al.swipeVelocityX||am.velocityY>al.swipeVelocityY){an.trigger(this.name,am);an.trigger(this.name+am.direction,am)}}}};(function(an){var am=false;function al(at,au){var aq=au.options,av=o.current,ar=o.previous,ap,ao;switch(at.eventType){case s:am=false;break;case G:am=am||(at.distance>aq.tapMaxDistance);break;case x:if(!R.inStr(at.srcEvent.type,"cancel")&&at.deltaTime<aq.tapMaxTime&&!am){ap=ar&&ar.lastEvent&&at.timeStamp-ar.lastEvent.timeStamp;ao=false;if(ar&&ar.name==an&&(ap&&ap<aq.doubleTapInterval)&&at.distance<aq.doubleTapDistance){au.trigger("doubletap",at);ao=true}if(!ao||aq.tapAlways){av.name=an;au.trigger(av.name,at)}}break}}H.gestures.Tap={name:an,index:100,handler:al,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:true,doubleTapDistance:20,doubleTapInterval:300}}})("tap");H.gestures.Touch={name:"touch",index:-Infinity,defaults:{preventDefault:false,preventMouse:false},handler:function h(al,am){if(am.options.preventMouse&&al.pointerType==ab){al.stopDetect();return}if(am.options.preventDefault){al.preventDefault()}if(al.eventType==O){am.trigger("touch",al)}}};(function(am){var al=false;function an(ap,aq){switch(ap.eventType){case s:al=false;break;case G:if(ap.touches.length<2){return}var ao=Math.abs(1-ap.scale);var ar=Math.abs(ap.rotation);if(ao<aq.options.transformMinScale&&ar<aq.options.transformMinRotation){return}o.current.name=am;if(!al){aq.trigger(am+"start",ap);al=true}aq.trigger(am,ap);if(ar>aq.options.transformMinRotation){aq.trigger("rotate",ap)}if(ao>aq.options.transformMinScale){aq.trigger("pinch",ap);aq.trigger("pinch"+(ap.scale<1?"in":"out"),ap)}break;case l:if(al&&ap.changedLength<2){aq.trigger(am+"end",ap);al=false}break}}H.gestures.Transform={name:am,index:45,defaults:{transformMinScale:0.01,transformMinRotation:1},handler:an}})("transform");if(typeof define=="function"&&define.amd){define(function(){return H})}else{if(typeof module!=="undefined"&&module.exports){module.exports=H}else{U.Hammer=H}}})(window);
/*! jQuery plugin for Hammer.JS - v1.1.3 - 2014-05-20
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
(function(b,c){function a(d,f){if(!Date.now){Date.now=function e(){return new Date().getTime()}}d.utils.each(["on","off"],function(g){d.utils[g]=function(h,j,i){f(h)[g](j,function(l){var m=f.extend({},l.originalEvent,l);if(m.button===c){m.button=l.which-1}i.call(this,m)})}});d.Instance.prototype.trigger=function(g,i){var h=f(this.element);if(h.has(i.target).length){h=f(i.target)}return h.trigger({type:g,gesture:i})};f.fn.hammer=function(g){return this.each(function(){var h=f(this);var i=h.data("hammer");if(!i){h.data("hammer",new d(this,g||{}))}else{if(i&&g){d.utils.extend(i.options,g)}}})}}if(typeof define=="function"&&define.amd){define(["hammerjs","jquery"],a)}else{a(b.Hammer,b.jQuery||b.Zepto)}})(window);"use strict";var Verge=Verge||{};Verge.Util=(function(f){var a=f("html");var e=f(".js-side-menu");var c=function(h){return h.type==="click"&&(h.which===1&&!h.metaKey&&!h.ctrlKey)};var g=function(h){if(typeof h==="undefined"||h.type!=="click"){return false}else{if(c(h)){return false}else{h.stopPropagation();return true}}};var b=function(){if(!a.hasClass("-is-locked")&&!Chorus.Environment.largeBreakpoint.matches){a.addClass("-is-locked");e.css({"overflow-y":"auto"})}};var d=function(){if(a.hasClass("-is-locked")){a.removeClass("-is-locked");e.css({"overflow-y":""})}};return{isLeftClick:c,stopMetaClickPropagation:g,lockScroll:b,unlockScroll:d}})(jQuery);var Chorus=Chorus||{};if(Util.canUseLocalStorage()&&typeof(sessionStorage)==="object"){Chorus.GBSignal=(function(c){var i="GBSignal";var g={loyaltySessions:[],currentSessionID:-1,totalSessionTime:0,totalSessionCounter:0};var q={};c.extend(q,g);var j={referralDomain:null,pagesSeeninSession:0,recordedSessionCount:false,sessionID:Math.random()};var d={};c.extend(d,j);function l(){if(!Util.isReferrerCurrentDomain()){j.referralDomain=Util.getReferrerDomain()}}function o(){j.pagesSeeninSession++}function f(){var u=(new Date())-(new Date(2014,0,0));var t=1000*60*60*24;return Math.floor(u/t)}function h(){if(!j.recordedSessionCount){g.loyaltySessions.push(f());j.recordedSessionCount=true}}function e(){var t=f()-30;var v=[];for(var u=0;u<g.loyaltySessions.length;u++){if(g.loyaltySessions[u]>t){v.push(g.loyaltySessions[u])}}g.loyaltySessions=v;return g.loyaltySessions.length}function n(){if(g.totalSessionCounter<1){return 0}return Math.ceil(g.totalSessionTime/g.totalSessionCounter)}function m(){sessionStorage.setItem(i,JSON.stringify(j));localStorage.setItem(i,JSON.stringify(g))}function p(){j=JSON.parse(sessionStorage.getItem(i));g=JSON.parse(localStorage.getItem(i));if(j===null||typeof(j)!=="object"){j={};c.extend(j,d)}if(g===null||typeof(g)!=="object"){g={};c.extend(g,q)}a()}function a(){for(var t in q){g[t]=g[t]||q[t]}for(t in d){sessionStorage[t]=sessionStorage[t]||d[t]}}function s(){if(typeof(window.onbeforeunload)!=="undefined"){var u=new Date();var t=function(){var v=Math.round(((new Date())-u)/1000);g.totalSessionTime+=v;if(g.currentSessionID!==j.sessionID){g.totalSessionCounter++}g.currentSessionID=j.sessionID;m()};c(window).on("beforeunload",t)}}function r(){return{loyalty_bsg:e(),avgsestime_bsg:n(),firstimp_bsg:j.pagesSeeninSession,referral_bsg:j.referralDomain}}function b(){var x=[];var v=r();for(var y in v){x.push(encodeURIComponent(y)+"="+encodeURIComponent(v[y]))}var u="http://js.moatads.com/essencedigital34895338176918191/moatcontent.js?"+x.join("&");var w=document.getElementsByTagName("script")[0];var t=document.createElement("SCRIPT");t.async=1;t.type="text/javascript";t.charset="UTF-8";t.src=u;w.parentNode.insertBefore(t,w)}return{init:function(){p();s();l();o();h();m();b()},results:function(){return r()}}})(jQuery);Chorus.GBSignal.init()}"use strict";var Verge=Verge||{};Verge.SideNav=(function(E){var z={root_selector:"#header",tabs_selector:".m-nav__menu li.has-dropdown",search_selector:".m-nav__menu li.has-dropdown.-search",nav_selector:".m-nav__container",site_nav_selector:".m-nav.-site",user_nav_selector:".m-nav.-user",sections_nav_selector:".m-nav.-sections",dropdown_selector:".m-nav-dropdown",dropdown_pane_selector:".m-nav-dropdown__pane",search_form_selector:".m-nav__search",side_nav_selector:".js-side-menu",open_site_nav_selector:".js-mobile-nav-menu-open",open_user_nav_selector:".js-mobile-user-menu-open",open_sections_nav_selector:".js-sections-menu-open",close_selector:".js-side-nav-close",back_to_top_selector:".-back-to-top a, .m-footer__back-to-top",open_nav_class:"is-nav-open",open_user_class:"is-user-nav-open",open_sections_class:"is-sections-nav-open",selected_section_class:"is-selected",animated_class:"is-animated",fixed_class:"is-fixed",hidden_class:"is-hidden",dropdown_endpoint:"/nav/dropdown"};var x=E(document);var P=E(window);var U=E("html, body");var i,q,y,t,b,G,s,I,S,T,a,v,f,l;var A=function(){if(!G.hasClass(z.open_nav_class)){q.addClass(z.animated_class);o();u();G.addClass(z.open_nav_class);G.trigger("Verge.openNav")}return false};var F=function(){if(G.hasClass(z.open_nav_class)){G.removeClass(z.open_nav_class);t.removeClass(z.selected_section_class);G.trigger("Verge.closeNav")}return false};var N=function(){if(!G.hasClass(z.open_sections_class)){G.trigger("Verge.closeNav");q.addClass(z.animated_class);F();G.addClass(z.open_sections_class);G.trigger("Verge.openNav")}return false};var u=function(){if(G.hasClass(z.open_sections_class)){G.removeClass(z.open_sections_class);G.trigger("Verge.closeNav")}return false};var j=function(V){if(Verge.Util.stopMetaClickPropagation(V)){return}if(!G.hasClass(z.open_user_class)){q.addClass(z.animated_class);F();b.removeClass(z.selected_section_class);G.addClass(z.open_user_class);G.trigger("Verge.openNav")}else{G.removeClass(z.open_user_class);G.trigger("Verge.closeNav")}return false};var o=function(){if(G.hasClass(z.open_user_class)){G.removeClass(z.open_user_class);G.trigger("Verge.closeNav")}return false};var J=function(V){if(Verge.Util.stopMetaClickPropagation(V)){return}if(G.hasClass(z.open_nav_class)||G.hasClass(z.open_user_class)||b.hasClass(z.selected_section_class)||G.hasClass(z.open_sections_class)){G.removeClass(z.open_nav_class+" "+z.open_user_class+" "+z.open_sections_class);t.removeClass(z.selected_section_class);b.removeClass(z.selected_section_class);G.trigger("Verge.closeNav")}};var H=function(){if(!Chorus.Environment.largeBreakpoint.matches){return}if(b.hasClass(z.selected_section_class)){b.removeClass(z.selected_section_class)}else{F();o();f.focus();b.addClass(z.selected_section_class);G.trigger("Verge.openNav")}return false};var w=function(X){var V=E(this);var W=V.parent();if(Verge.Util.stopMetaClickPropagation(X)||!Chorus.Environment.largeBreakpoint.matches){return}if(W.hasClass(z.selected_section_class)){W.removeClass(z.selected_section_class);F()}else{t.removeClass(z.selected_section_class);b.removeClass(z.selected_section_class);W.addClass(z.selected_section_class);B(V.data("section"))}return false};var B=function(V){if(!G.hasClass(z.open_nav_class)){A()}i.data().selected=V;if(i.data().loaded){c()}else{O()}};var c=function(){var W=E("#nav-"+i.data().selected);var V;if(W.length===0){return}V=W.position().left*-1;if(Modernizr.csstransforms3d){I.css("transform","translate3d("+V+"px, 0, 0)")}else{I.css("left",V)}if(!Modernizr.csstransitions||!I.hasClass(z.animated_class)){L()}};var O=function(){if(!i.data().loading){i.data().loading=true;E.get(z.dropdown_endpoint,function(V){i.data().loaded=true;i.data().loading=false;I.html(V);c()})}};var K=function(){if(G.hasClass(z.open_nav_class)){I.addClass(z.animated_class)}else{I.removeClass(z.animated_class)}return false};var L=function(){var V=E("#nav-"+i.data().selected);Chorus.DynamicSizedImages.applyTo(V);return false};var M=function(){if(Chorus.Environment.largeBreakpoint.matches&&!G.hasClass(z.fixed_class)){G.data().sticky_threshold=i.offset().top}};var m=function(){if(!Chorus.Environment.largeBreakpoint.matches){G.removeClass(z.fixed_class);i.removeClass(z.hidden_class);return}if(typeof G.data().sticky_threshold==="undefined"){M()}var W=P.scrollTop();var V=G.hasClass(z.fixed_class);if(W>G.data().sticky_threshold){if(!V){G.addClass(z.fixed_class);G.trigger("Verge.stickNav")}n(W)}else{if(V){G.removeClass(z.fixed_class);i.removeClass(z.hidden_class);i.css({visibility:"visible"});M()}}};var n=function(V){if(typeof i.data().scroll==="undefined"){i.data().scroll=V;return}var W=G.data().sticky_threshold;var X=i.data().scroll;var Y=i.hasClass(z.hidden_class);if((V>W+l)&&(V>X)&&!Y){i.addClass(z.hidden_class);if(!Modernizr.csstransitions){G.trigger("Verge.hideNav");i.css({visibility:"hidden"})}}else{if(((V<X-50)||(V<=W+l))&&Y){i.css({visibility:"visible"});i.removeClass(z.hidden_class)}}i.data().scroll=V};var C=function(){if(i.hasClass(z.hidden_class)){G.trigger("Verge.hideNav");i.css({visibility:"hidden"})}};var p=function(){U.animate({scrollTop:0});return false};var h=function(W){var V=E(this);var X;if(Chorus.Environment.largeBreakpoint.matches){return}switch(W.type){case"touch":V.removeClass(z.animated_class);g(V);break;case"dragleft":case"dragright":W.gesture.preventDefault();X=V.data().offset+W.gesture.deltaX;r(V,X,W.gesture.direction);break;case"swipeleft":case"swiperight":W.gesture.preventDefault();V.addClass(z.animated_class);if(V.hasClass(W.gesture.direction)){V.trigger("Verge.swipeClose")}d(V);W.gesture.stopDetect();break;case"release":V.addClass(z.animated_class);if((Math.abs(W.gesture.deltaX)>V.width()/4)&&(V.hasClass(W.gesture.direction))){V.trigger("Verge.swipeClose")}d(V);break}};var r=function(V,X,W){if(!V.hasClass(W)){return}if(Modernizr.realcsstransforms3d){V.css("transform","translate3d("+X+"px, 0, 0)")}else{X=W==="right"?X*-1:X;V.css(W,X)}};var g=function(V){var W;if(Modernizr.realcsstransforms3d){W=V.css("transform");if(W.match("matrix3d")){V.data().offset=parseInt(V.css("transform").split(", ")[12])}else{V.data().offset=parseInt(V.css("transform").split(", ")[4])}}else{V.data().offset=V.css("left")==="auto"?parseInt(V.css("right")):parseInt(V.css("left"))}};var d=function(V){if(Modernizr.realcsstransforms3d){V.css("transform","")}else{V.css({left:"",right:""})}};var D=function(V){G.addClass("-header-reskin");if(V.useAlternateSocialIcons){G.addClass("-light-social-icons")}M()};var R=function(){Verge.Util.unlockScroll();J();M();m();q.addClass(z.animated_class);l=E(z.site_nav_selector).height()};var e=function(V){V.gesture.preventDefault();if(V.type==="release"){i.trigger("Verge.swipeClose")}};var Q=function(V){E.extend(z,V);G=E(z.root_selector);if(G.length===0){return}t=E(z.tabs_selector).not(z.search_selector);b=E(z.search_selector);i=E(z.nav_selector);s=E(z.dropdown_selector);I=E(z.dropdown_pane_selector);q=E(z.side_nav_selector);y=E(z.close_selector);S=E(z.open_user_nav_selector);T=E(z.open_site_nav_selector);a=E(z.open_sections_nav_selector);v=E(z.search_form_selector);f=v.find("input[name=q]");S.on("click",j);T.on("click",A);a.on("click",N);E(z.back_to_top_selector).on("click",p);s.on("click",function(W){W.stopPropagation()});y.hammer().on("touch release drag swipe",e);t.on("click","> a",w);b.on("click","> a",H);q.hammer().on("touch release dragleft dragright swipeleft swiperight",h);v.on("click",function(W){W.stopPropagation()});q.on("click",function(W){W.stopPropagation()});G.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",z.dropdown_selector,K);G.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",z.dropdown_pane_selector,L);G.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",z.nav_selector,C);G.on("Verge.openNewArticlesEnd Verge.closeNewArticlesEnd",M);x.on("Verge.openNewArticlesStart Verge.openBigStories Verge.swipeClose Verge.hideNav click",J);x.on("scroll",_.throttle(m,50));x.on("Verge.openNav",Verge.Util.lockScroll);x.on("Verge.closeNav",Verge.Util.unlockScroll);Chorus.EventDispatcher.subscribe("campaignReskinApplied",D);Chorus.Environment.largeBreakpoint.addListener(R);R()};return{init:Q}})(jQuery).init();"use strict";var Verge=Verge||{};Verge.NewArticles=(function(f){var a={root_selector:"#header",new_articles:".m-new-articles",toggle_selector:"#js-new-articles-toggle",close_selector:"#js-side-nav-close",open_class:"is-new-articles-open"};var e=f(document);var c,i;var h=function(){if(i.hasClass(a.open_class)){g()}else{d()}return false};var d=function(){i.addClass(a.open_class);c.trigger("Verge.openNewArticlesStart");if(!Modernizr.csstransitions){c.trigger("Verge.openNewArticlesEnd")}return false};var g=function(){if(i.hasClass(a.open_class)){i.removeClass(a.open_class);c.trigger("Verge.closeNewArticlesStart");if(!Modernizr.csstransitions){c.trigger("Verge.closeNewArticlesEnd")}}};var j=function(){if(i.hasClass(a.open_class)){c.trigger("Verge.openNewArticlesEnd")}else{c.trigger("Verge.closeNewArticlesEnd")}};var b=function(){g();c.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",j)};var l=function(m){f.extend(a,m);i=f(a.root_selector);if(i.length===0){return}c=f(a.new_articles);i.on("click",a.toggle_selector,h);i.on("click",a.close_selector,g);e.on("Verge.openNewArticlesStart",Verge.Util.lockScroll);e.on("Verge.closeNewArticlesStart",Verge.Util.unlockScroll);e.on("Verge.openBigStories Verge.swipeClose",g);Chorus.Environment.largeBreakpoint.addListener(b);b()};return{init:l}})(jQuery).init();"use strict";var Verge=Verge||{};Verge.BigStories=(function(d){var b={root_selector:"#header",big_stories:".m-big-stories",toggle_selector:"#big-stories-toggle",open_class:"is-open"};var c,g;var f=function(){if(c.hasClass(b.open_class)){a()}else{e()}return false};var e=function(){c.addClass(b.open_class);g.trigger("Verge.openBigStories");return false};var a=function(i){if(Verge.Util.stopMetaClickPropagation(i)){return}c.removeClass(b.open_class)};var h=function(i){d.extend(b,i);g=d(b.root_selector);if(g.length===0){return}c=d(b.big_stories);g.on("click",b.toggle_selector,f);d(document).on("Verge.openNewArticlesStart Verge.stickNav Verge.openNav click",a);Chorus.Environment.largeBreakpoint.addListener(a)};return{init:h}})(jQuery).init();"use strict";var Verge=Verge||{};Verge.Carousel=(function(h){var b={carousel_selector:".js-carousel",pane_selector:".js-carousel-pane",list_selector:".js-carousel-list",item_selector:".js-carousel-item",control_selector:".js-carousel-control",prev_class:"-previous",next_class:"-next",active_class:"is-active",animated_class:"is-animated"};var p=function(r){if(r.data().initialized){return}var s=r.find(b.item_selector);c(r);i(r,s);e(r);r.on("click",b.control_selector,{carousel:r},n);r.on("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend",b.list_selector,g);r.find(b.list_selector).hammer({drag_lock_to_axis:true}).on("click touch release dragleft dragright swipeleft swiperight",q);r.addClass(b.animated_class);r.data().initialized=true};var c=function(s){var r=s.data("items-per-page");s.data().items_per_page=typeof r==="undefined"?1:r};var i=function(u,x){var s=x.length;var t=u.data().items_per_page;var r=s%t;var v=s/t;var w=(r>0)?Math.ceil(v):Math.floor(v);u.data().item_count=s;u.data().page={on:1,total:w,position:0}};var e=function(t){var u=t.data().page;var r=t.find("."+b.next_class);var s=t.find("."+b.prev_class);if(t.data().item_count>t.data().items_per_page){if(u.on===1){s.removeClass(b.active_class);r.addClass(b.active_class)}else{if(u.on<u.total){s.addClass(b.active_class);r.addClass(b.active_class)}else{s.addClass(b.active_class);r.removeClass(b.active_class)}}}};var n=function(t){var r=t.data.carousel;var s=h(this);t.preventDefault();if(!s.hasClass(b.active_class)){return}if(s.hasClass(b.prev_class)){f(r)}else{if(s.hasClass(b.next_class)){l(r)}}};var l=function(r){var s=r.data().page.on;m(r,s+1)};var f=function(r){var s=r.data().page.on;m(r,s-1)};var m=function(u,v){var r=u.data().page.total;var t=u.data().items_per_page;var s=0;if(v<1){v=1}else{if(v>r){v=r}}s=t*(v-1);u.data().page.position=Math.round(u.find(b.item_selector).eq(s).position().left*-1);u.data().page.on=v;d(u);e(u)};var d=function(t,u){var s=t.find(b.list_selector);var r;u=typeof u==="undefined"?0:u;r=t.data().page.position+u;if(Modernizr.csstransforms3d){s.css("transform","translate3d("+r+"px, 0, 0)")}else{s.css("left",r)}if(!Modernizr.csstransitions&&u===0){Chorus.DynamicSizedImages.applyTo(s)}};var q=function(w){var t=h(this).parents(b.carousel_selector);var v=t.data().page.on;var r=t.data().page.total;var u=t.find(b.pane_selector).width();var s;switch(w.type){case"touch":t.removeClass(b.animated_class);t.data().dragged=false;break;case"dragright":case"dragleft":t.data().dragged=true;w.gesture.preventDefault();s=w.gesture.deltaX;if((v===1&&w.gesture.direction==="right")||(v===r&&w.gesture.direction==="left")){s*=0.1}d(t,s);break;case"swipeleft":t.data().dragged=true;w.gesture.preventDefault();t.addClass(b.animated_class);l(t);w.gesture.stopDetect();break;case"swiperight":t.data().dragged=true;w.gesture.preventDefault();t.addClass(b.animated_class);f(t);w.gesture.stopDetect();break;case"release":t.addClass(b.animated_class);if(Math.abs(w.gesture.deltaX)>u/4){if(w.gesture.direction==="right"){f(t)}else{l(t)}}else{d(t)}break;case"click":if(t.data().dragged){w.preventDefault()}t.data().dragged=false;break}};var g=function(){Chorus.DynamicSizedImages.applyTo(h(this))};var a=function(r){if(r.data().initialized){r.find(b.list_selector).removeAttr("style");r.removeData("page initialized items_per_page item_count");r.off("click",b.control_selector);r.off("webkitTransitionEnd oTransitionEnd msTransitionEnd transitionend");r.find(b.list_selector).hammer().off("touch release dragleft dragright swipeleft swiperight")}};var j=function(){h(b.carousel_selector).each(function(){var r=h(this);var s=_.isUndefined(r.data("carousel-no-scroll"))?false:true;if(s||Chorus.Environment.largeBreakpoint.matches){p(r)}else{a(r)}})};var o=function(){Chorus.Environment.largeBreakpoint.addListener(j);j()};return{init:o,goToPage:m}})(jQuery);jQuery(function(){Verge.Carousel.init()});"use strict";var Verge=Verge||{};Verge.CollapsibleTabs=(function(d){var c={tabs:d(".p-tabs.js-collapsible"),tab_selector:"li",active_tab_selector:"li.-is-active",active_class:"-is-active"};var b=function(){var g=d(this);var h=g.parents(".p-tabs");if(h.hasClass("js-stream-sort")){h.find("[data-sort="+g.val()+"]").trigger("click")}else{window.location.href=g.val()}};var a=function(){var l=c.tabs.length;var g,j;for(var h=0;h<l;h+=1){j=d(c.tabs[h]);if(j.hasClass("js-stream-sort")){g=j.find(c.tab_selector)}else{g=j.find(c.active_tab_selector)}g.append(e(j))}};var e=function(o){var r=[];var n=o.find(c.tab_selector);var g=n.length;var l=0;var q,h,j,m;for(var p=0;p<g;p+=1){q=d(n[l]);if(o.hasClass("js-stream-sort")){h=q.find("a").data("sort")}else{h=q.find("a").attr("href")}j=q.hasClass(c.active_class)?" selected ":"";m='<option value="'+h+'"'+j+">"+q.text()+"</option>";r[++l]=m}return"<select>"+r.join("")+"</select>"};var f=function(){c.tabs.on("change","select",b);a()};return{init:f}})(jQuery).init();"use strict";var Verge=Verge||{};Verge.App=(function(){var a=function(){var b=document.getElementById("header");if(b){FastClick.attach(b)}Modernizr.addTest("realcsstransforms3d",function(){return Modernizr.csstransforms3d&&typeof window.navigator.msPointerEnabled==="undefined"});Modernizr.addTest("ios",function(){return window.navigator.userAgent.match(/iphone|ipad|ipod/i)});Modernizr.addTest("chorustouch",function(){return Chorus.Environment.touch()});Chorus.Environment.smallBreakpoint.addListener(function(){Chorus.DynamicSizedImages.init()})};return{init:a}})().init();"use strict";var Verge=Verge||{};Verge.Newsletter=(function(d){var c;var a;function e(){c=d("#newsletter-signup-step1");if(c.length){c.on("submit",b);a=d("#newsletter-signup-step2")}}function b(f){f.preventDefault();var g=c.find('input[name="email"]').val();if(g){a.find('input[name="email"]').val(g);Chorus.EventDispatcher.publish("modal_open",{content:a.show()})}}return{init:e}})(jQuery);jQuery(function(){Verge.Newsletter.init()});var Verge=Verge||{};Verge.VideoHero=(function(e){var a={video_hero:e("#video-hero"),player_container:e("#video-hero-player"),player_container_id:"video-hero-player",playlist:e(".m-video-hero__playlist"),playlist_entries:e(".m-video-hero__playlist-entry"),comment_link:e(".m-video-hero__comment-link"),original_comment_text:e(".m-video-hero__comment-link").text(),headline_link:e(".m-video-hero__watch-now"),more_videos_link:e(".m-video-hero__more-videos"),video_entries:e(".m-video-hero__main-entry"),playing_class:"is-playing",not_playing_class:"is-not-playing",hidden_class:"is-hidden",linkset_class:"js-video-linkset",playlist_video_class:"js-playlist",video_link_selector:".m-video-hero__main-link",play_video_selector:"a:not(.m-video-hero__more-videos)"};var f;var m;var i=function(u){var v=e(this),t=v.parent().attr("id"),n=v.attr("href"),s=v.data("chorus-video-id"),p=v.data("ooyala-video-id"),q=v.data("embed-code"),o=v.data("bottom-call-to-action-text")||a.original_comment_text,x=v.data("list-position"),r,w="video:play:"+f;if(a.playlist.length>0){w+=(v.hasClass(a.playlist_video_class)?(":list"+x):":main")}if(Verge.Util.stopMetaClickPropagation(u)){return}a.comment_link.text(o);if(typeof s!=="undefined"){Chorus.VideoContext.createPlayer(a.player_container_id,s,{autoplay:true,ga:{eventAction:w}})}else{if(typeof q!=="undefined"){a.player_container.html(q)}else{if(typeof p!=="undefined"){r=Chorus.VideoContext.addVideoFromOoyalaIdWithTitle(p,"title here");Chorus.VideoContext.createPlayer(a.player_container_id,r,{autoplay:true})}}}a.playlist_entries.removeClass(a.playing_class).addClass(a.not_playing_class);v.parent().toggleClass(a.playing_class+" "+a.not_playing_class);if(n==="#"){a.comment_link.addClass(a.hidden_class)}else{a.comment_link.removeClass(a.hidden_class);a.comment_link.attr("href",n)}return false};var b=function(p){var n,o;if(Verge.Util.stopMetaClickPropagation(p)){return}n=e(this);o=a.playlist;if(o.hasClass("-expanded")){o.removeClass("-expanded");n.find("span").text("more")}else{o.addClass("-expanded");n.find("span").text("fewer")}return false};var h=function(n,o){var q=d(n,o);var p=e("#link-set-"+q.id);m=n||[];p.removeClass("hidden");a.video_entries.remove(".hidden");g(q,p,n);Chorus.VideoContext.addVideos(n)};var c=function(){return JSON.parse(Util.canUseLocalStorage()?localStorage.getItem("viewedVideos"):null)||[]};var d=function(n,p){var s=c();var q=s.map(function(u){return u.id});var t=s.map(function(u){return u.provider_video_id});var r;n=n.filter(function(u){return u.id!==p.id&&u.provider_video_id!==p.provider_video_id});for(var o=0;o<n.length;o++){r=n[o];if(q.indexOf(r.id)===-1&&t.indexOf(r.provider_video_id)===-1){break}}return r};var g=function(r,q,n){var n=n||[];var p=c();var s=a.video_hero.hasClass(a.linkset_class)?"entry:linkset":"hub:hero";s+=a.playlist.length>0?":playlist1":"";var o="video:view:"+s;q.waypoint(function(){ga("send","event","video",o+":main",r.title,{nonInteraction:1});e("."+a.playlist_video_class).each(function(v,u){var w=e(u);ga("send","event","video",o+":list"+w.data("list-position"),w.data("video-title"),{nonInteraction:1})});if(Util.canUseLocalStorage()){var t={id:r.id,provider_video_id:r.provider_video_id};p.unshift(t);p=p.slice(0,5);localStorage.viewedVideos=JSON.stringify(p)}},{offset:"bottom-in-view",triggerOnce:true})};var l=function(){if(Util.UserAgentProfiler.isIOS()||Util.UserAgentProfiler.isAndroid()){a.video_hero.find(a.video_link_selector).trigger({type:"click",which:1})}};var j=function(n){e.extend(a,n);f=a.video_hero.hasClass(a.linkset_class)?"entry:linkset":"hub:hero";f+=a.playlist.length>0?":playlist1":"";a.video_hero.on("click",a.play_video_selector,i);if(Chorus.Environment.touch()){a.more_videos_link.on("click",b)}};return{init:j,unhide:h,watchLinkset:g}})(jQuery);jQuery(Verge.VideoHero.init);"use strict";var Verge=Verge||{};Verge.TabbedSwitcher=(function(c){var b={tabs:c(".js-tab-switcher li"),pages:c(".js-tab-page"),active_class:"-is-active"};var a=function(){var e=c(this);var g=e.parent();var f=b.pages.filter(e.attr("href"));if(f.length>0){b.pages.hide();b.tabs.removeClass(b.active_class);f.show();g.addClass(b.active_class);Chorus.DynamicSizedImages.applyTo(f)}return false};var d=function(){b.tabs.on("click","a",a)};return{init:d}})(jQuery).init();var Chorus=Chorus||{};Chorus.UserMessaging=(function(f){var d;var l=Chorus.Context.network_slug==="polygon";var j=30000;var c=4000;function b(m){m.on("webkittransitionend transitionend otransitionEnd mstransitionend transitionend",function(){m.remove()});m.addClass("is-closed")}function i(m){m.preventDefault();m.stopPropagation();b(f(m.delegateTarget))}function g(){var m=f(".m-user-msg__notice");if(m.length>1){h()}m.first().find(".m-user-msg__close").trigger("click")}function h(){if(l===true){dur=(f(".m-user-msg__notice_short").length>0)?c:j;to=setTimeout(g,dur)}}function e(){f(".m-user-msg__notice, .m-user-msg__error").on("click",".m-user-msg__close",i)}function a(){f(".m-user-msg__modal").each(function(){Chorus.EventDispatcher.publish("modal_open",{content:f(this)})})}return{init:function(){if(f(".m-user-msg").length<1){return}a();e();h()}}})(jQuery);jQuery(Chorus.UserMessaging.init);var Chorus=Chorus||{};Chorus.Modal=(function(e){var t=null;var n,q,u;var f=[];var w=false;function p(){if(t!==null){return}var y=e(u());n.append(y);y.on("click",o);t=y.find(".m-chorus-modal__root").addBack(".m-chorus-modal__root").first()}function d(){p();n.addClass("chorus-modal-loading")}function x(){n.removeClass("chorus-modal-loading")}function b(){p();n.addClass("chorus-modal-open")}function c(){n.removeClass("chorus-modal-open")}function r(y){d();var z=y.data||{};y.success=function(A){y.content=A;l(y)};y.error=function(B,A){if(A!=="abort"){alert("There was an error recieving data from the server.")}x()};f.push(e.ajax(y))}function l(z){x();b();var y=e(q(z));y.find(".m-chorus-modal__window-root").append(z.content);y.data("chorus-modal-callbacks",z.callbacks);t.prepend(y);y.on("click","*[data-chorus-modal-action]",s);i("attach",y)}function v(y){y.remove();if(t.children().length===0){c();x()}}function g(y){y.callbacks=y.callbacks||{};y.title=y.title||"Untitled Modal";y.content=y.content||null;if(y.url){r(y)}else{if(y.content!==null){l(y)}}}function i(A,z){var y=z.data("chorus-modal-callbacks");if(A==="cancel_confirm"){if(confirm("Are you sure you want to close this window?")){A="cancel"}else{return}}if(typeof(y[A])==="function"){y[A](z)}if(A=="cancel"||A=="close"){v(z)}}function a(){Chorus.EventDispatcher.publish("modal_closed_by_modaljs");e(".m-chorus-modal__window").each(function(){i("cancel",e(this))});if(t!==null){t.empty()}c();x();while(f.length>0){f.pop().abort()}}function j(){w=true;var y=e("#chorus-modal-window-template").html()||"";var z=e("#chorus-modal-wrapper-template").html()||"";n=e("body");q=_.template(y);u=_.template(z)}function s(y){y.preventDefault();i(e(y.target).data("chorus-modal-action").toString().trim(),e(y.delegateTarget))}function o(y){if(e(y.target).is(t)){a()}}function h(y){if(w===false){j()}g(y)}function m(y){a()}return{init:function(){Chorus.EventDispatcher.subscribe("modal_open",h);Chorus.EventDispatcher.subscribe("modal_close",m)},open:function(y){Chorus.EventDispatcher.publish("modal_open",y)},close:function(y){Chorus.EventDispatcher.publish("modal_close",y)}}})(jQuery);Chorus.Modal.init();var shortcut={all_shortcuts:{},add:function(b,h,d){var g={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!d){d=g}else{for(var a in g){if(typeof d[a]=="undefined"){d[a]=g[a]}}}var f=d.target;if(typeof d.target=="string"){f=document.getElementById(d.target)}var c=this;b=b.toLowerCase();var e=function(o){o=o||window.event;if(d.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var s=b.split("+");var r=0;var p={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var q={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){q.ctrl.pressed=true}if(o.shiftKey){q.shift.pressed=true}if(o.altKey){q.alt.pressed=true}if(o.metaKey){q.meta.pressed=true}for(var j=0;k=s[j],j<s.length;j++){if(k=="ctrl"||k=="control"){r++;q.ctrl.wanted=true}else{if(k=="shift"){r++;q.shift.wanted=true}else{if(k=="alt"){r++;q.alt.wanted=true}else{if(k=="meta"){r++;q.meta.wanted=true}else{if(k.length>1){if(m[k]==code){r++}}else{if(d.keycode){if(d.keycode==code){r++}}else{if(n==k){r++}else{if(p[n]&&o.shiftKey){n=p[n];if(n==k){r++}}}}}}}}}}if(r==s.length&&q.ctrl.pressed==q.ctrl.wanted&&q.shift.pressed==q.shift.wanted&&q.alt.pressed==q.alt.wanted&&q.meta.pressed==q.meta.wanted){h(o);if(!d.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[b]={callback:e,target:f,event:d.type};if(f.addEventListener){f.addEventListener(d.type,e,false)}else{if(f.attachEvent){f.attachEvent("on"+d.type,e)}else{f["on"+d.type]=e}}},remove:function(a){a=a.toLowerCase();var d=this.all_shortcuts[a];delete (this.all_shortcuts[a]);if(!d){return}var b=d.event;var c=d.target;var e=d.callback;if(c.detachEvent){c.detachEvent("on"+b,e)}else{if(c.removeEventListener){c.removeEventListener(b,e,false)}else{c["on"+b]=false}}}};(function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=false;if(typeof settings=="string"){method=settings;params=extraSettings}options={id:"",nameSpace:"",root:"",previewHandler:false,previewInWindow:"",previewInElement:"",previewAutoRefresh:true,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:false,previewParserPath:"",previewParserVar:"data",resizeHandle:true,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]};$.extend(options,settings,extraSettings);if(!options.root){$("script").each(function(a,tag){miuScript=$(tag).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/);if(miuScript!==null){options.root=miuScript[1]}})}var uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}};var matched=uaMatch(navigator.userAgent);var browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version}if(browser.chrome){browser.webkit=true}else{if(browser.webkit){browser.safari=true}}return this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this);textarea=this;levels=[];abort=false;scrollPosition=caretPosition=0;caretOffset=-1;options.previewParserPath=localize(options.previewParserPath);options.previewTemplatePath=localize(options.previewTemplatePath);if(method){switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}return}function localize(data,inText){if(inText){return data.replace(/("|')~\//g,"$1"+options.root)}return data.replace(/^~\//,options.root)}function init(){id="";nameSpace="";if(options.id){id='id="'+options.id+'"'}else{if($$.attr("id")){id='id="markItUp'+($$.attr("id").substr(0,1).toUpperCase())+($$.attr("id").substr(1))+'"'}}if(options.nameSpace){nameSpace='class="'+options.nameSpace+'"'}$$.wrap("<div "+nameSpace+"></div>");$$.wrap("<div "+id+' class="markItUp"></div>');$$.wrap('<div class="markItUpContainer"></div>');$$.addClass("markItUpEditor");header=$('<div class="markItUpHeader"></div>').insertBefore($$);$(dropMenus(options.markupSet)).appendTo(header);footer=$('<div class="markItUpFooter"></div>').insertAfter($$);if(options.resizeHandle===true&&browser.safari!==true){resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var h=$$.height(),y=e.clientY,mouseMove,mouseUp;mouseMove=function(e){$$.css("height",Math.max(20,e.clientY+h-y)+"px");return false};mouseUp=function(e){$("html").unbind("mousemove.markItUp",mouseMove).unbind("mouseup.markItUp",mouseUp);return false};$("html").bind("mousemove.markItUp",mouseMove).bind("mouseup.markItUp",mouseUp)});footer.append(resizeHandle)}$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed);$$.bind("insertion.markItUp",function(e,settings){if(settings.target!==false){get()}if(textarea===$.markItUp.focused){markup(settings)}});$$.bind("focus.markItUp",function(){$.markItUp.focused=this});if(options.previewInElement){refreshPreview()}}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;$("li:hover > ul",ul).css("display","block");$.each(markupSet,function(){var button=this,t="",title,li,j;title=(button.key)?(button.name||"")+" [Ctrl+"+button.key+"]":(button.name||"");key=(button.key)?'accesskey="'+button.key+'"':"";if(button.separator){li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul)}else{i++;for(j=levels.length-1;j>=0;j--){t+=levels[j]+"-"}li=$('<li class="markItUpButton markItUpButton'+t+(i)+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return false}).bind("click.markItUp",function(e){e.preventDefault()}).bind("focusin.markItUp",function(){$$.focus()}).bind("mouseup",function(){if(button.call){eval(button.call)()}markup(button);return false}).bind("mouseenter.markItUp",function(){$("> ul",this).show();$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul);if(button.dropMenu){levels.push(i);$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu))}}});levels.pop();return ul}function magicMarkups(string){if(string){string=string.toString();string=string.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(x,a){var b=a.split("|!|");if(altKey===true){return(b[1]!==undefined)?b[1]:b[0]}else{return(b[1]===undefined)?"":b[0]}});string=string.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(x,a){var b=a.split(":!:");if(abort===true){return false}value=prompt(b[0],(b[1])?b[1]:"");if(value===null){abort=true}return value});return string}return""}function prepare(action){if($.isFunction(action)){action=action(hash)}return magicMarkups(action)}function build(string){var openWith=prepare(clicked.openWith);var placeHolder=prepare(clicked.placeHolder);var replaceWith=prepare(clicked.replaceWith);var closeWith=prepare(clicked.closeWith);var openBlockWith=prepare(clicked.openBlockWith);var closeBlockWith=prepare(clicked.closeBlockWith);var multiline=clicked.multiline;if(replaceWith!==""){block=openWith+replaceWith+closeWith}else{if(selection===""&&placeHolder!==""){block=openWith+placeHolder+closeWith}else{string=string||selection;var lines=[string],blocks=[];if(multiline===true){lines=string.split(/\r?\n/)}for(var l=0;l<lines.length;l++){line=lines[l];var trailingSpaces;if(trailingSpaces=line.match(/ *$/)){blocks.push(openWith+line.replace(/ *$/g,"")+closeWith+trailingSpaces)}else{blocks.push(openWith+line+closeWith)}}block=blocks.join("\n")}}block=openBlockWith+block+closeBlockWith;return{block:block,openBlockWith:openBlockWith,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith,closeBlockWith:closeBlockWith}}function markup(button){var len,j,n,i;hash=clicked=button;get();$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:(selection||""),caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey});prepare(options.beforeInsert);prepare(clicked.beforeInsert);if((ctrlKey===true&&shiftKey===true)||button.multiline===true){prepare(clicked.beforeMultiInsert)}$.extend(hash,{line:1});if((ctrlKey===true&&shiftKey===true)){lines=selection.split(/\r?\n/);for(j=0,n=lines.length,i=0;i<n;i++){if($.trim(lines[i])!==""){$.extend(hash,{line:++j,selection:lines[i]});lines[i]=build(lines[i]).block}else{lines[i]=""}}string={block:lines.join("\n")};start=caretPosition;len=string.block.length+((browser.opera)?n-1:0)}else{if(ctrlKey===true){string=build(selection);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;len=len-(string.block.match(/ $/)?1:0);len-=fixIeBug(string.block)}else{if(shiftKey===true){string=build(selection);start=caretPosition;len=string.block.length;len-=fixIeBug(string.block)}else{string=build(selection);start=caretPosition+string.block.length;len=0;start-=fixIeBug(string.block)}}}if((selection===""&&string.replaceWith==="")){caretOffset+=fixOperaBug(string.block);start=caretPosition+string.openBlockWith.length+string.openWith.length;len=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length;caretOffset=$$.val().substring(caretPosition,$$.val().length).length;caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))}$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition});if(string.block!==selection&&abort===false){insert(string.block);set(start,len)}else{caretOffset=-1}get();$.extend(hash,{line:"",selection:selection});if((ctrlKey===true&&shiftKey===true)||button.multiline===true){prepare(clicked.afterMultiInsert)}prepare(clicked.afterInsert);prepare(options.afterInsert);if(previewWindow&&options.previewAutoRefresh){refreshPreview()}shiftKey=altKey=ctrlKey=abort=false}function fixOperaBug(string){if(browser.opera){return string.length-string.replace(/\n*/g,"").length}return 0}function fixIeBug(string){if(browser.msie){return string.length-string.replace(/\r*/g,"").length}return 0}function insert(block){if(document.selection){var newSelection=document.selection.createRange();newSelection.text=block}else{textarea.value=textarea.value.substring(0,caretPosition)+block+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}}function set(start,len){if(textarea.createTextRange){if(browser.opera&&browser.version>=9.5&&len==0){return false}range=textarea.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",len);range.select()}else{if(textarea.setSelectionRange){textarea.setSelectionRange(start,start+len)}}textarea.scrollTop=scrollPosition;textarea.focus()}function get(){textarea.focus();scrollPosition=textarea.scrollTop;if(document.selection){selection=document.selection.createRange().text;if(browser.msie){var range=document.selection.createRange(),rangeCopy=range.duplicate();rangeCopy.moveToElementText(textarea);caretPosition=-1;while(rangeCopy.inRange(range)){rangeCopy.moveStart("character");caretPosition++}}else{caretPosition=textarea.selectionStart}}else{caretPosition=textarea.selectionStart;selection=textarea.value.substring(caretPosition,textarea.selectionEnd)}return selection}function preview(){if(typeof options.previewHandler==="function"){previewWindow=true}else{if(options.previewInElement){previewWindow=$(options.previewInElement)}else{if(!previewWindow||previewWindow.closed){if(options.previewInWindow){previewWindow=window.open("","preview",options.previewInWindow);$(window).unload(function(){previewWindow.close()})}else{iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>');if(options.previewPosition=="after"){iFrame.insertAfter(footer)}else{iFrame.insertBefore(header)}previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]}}else{if(altKey===true){if(iFrame){iFrame.remove()}else{previewWindow.close()}previewWindow=iFrame=false}}}}if(!options.previewAutoRefresh){refreshPreview()}if(options.previewInWindow){previewWindow.focus()}}function refreshPreview(){renderPreview()}function renderPreview(){var phtml;if(options.previewHandler&&typeof options.previewHandler==="function"){options.previewHandler($$.val())}else{if(options.previewParser&&typeof options.previewParser==="function"){var data=options.previewParser($$.val());writeInPreview(localize(data,1))}else{if(options.previewParserPath!==""){$.ajax({type:"POST",dataType:"text",global:false,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(data){writeInPreview(localize(data,1))}})}else{if(!template){$.ajax({url:options.previewTemplatePath,dataType:"text",global:false,success:function(data){writeInPreview(localize(data,1).replace(/<!-- content -->/g,$$.val()))}})}}}}return false}function writeInPreview(data){if(options.previewInElement){$(options.previewInElement).html(data)}else{if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open();previewWindow.document.write(data);previewWindow.document.close();previewWindow.document.documentElement.scrollTop=sp}}}function keyPressed(e){shiftKey=e.shiftKey;altKey=e.altKey;ctrlKey=(!(e.altKey&&e.ctrlKey))?(e.ctrlKey||e.metaKey):false;if(e.type==="keydown"){if(ctrlKey===true){li=$('a[accesskey="'+((e.keyCode==13)?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li");if(li.length!==0){ctrlKey=false;li.triggerHandler("mouseup");return false}}if(e.keyCode===13||e.keyCode===10){if(ctrlKey===true){ctrlKey=false;markup(options.onCtrlEnter);return options.onCtrlEnter.keepDefault}else{if(shiftKey===true){shiftKey=false;markup(options.onShiftEnter);return options.onShiftEnter.keepDefault}else{markup(options.onEnter);return options.onEnter.keepDefault}}}if(e.keyCode===9){if(shiftKey==true||ctrlKey==true||altKey==true){return false}if(caretOffset!==-1){get();caretOffset=$$.val().length-caretOffset;set(caretOffset,0);caretOffset=-1;return false}else{markup(options.onTab);return options.onTab.keepDefault}}}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor");$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$);$$.data("markItUp",null)}init()})};$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})};$.markItUp=function(settings){var options={target:false};$.extend(options,settings);if(options.target){return $(options.target).each(function(){$(this).focus();$(this).trigger("insertion",[options])})}else{$("textarea").trigger("insertion",[options])}}})(jQuery);window.Chorus||(Chorus={});Chorus.Comments=_.extend({},Backbone.Events,{Collections:{},Models:{},Views:{},Mixins:{},autoUpdateTimeout:null,defaults:{ajaxParams:{},ajaxTimeout:15000,alertErrors:true,avatarBreakpointIndex:2,autoUpdateAlertMaxShown:5,autoUpdateAlertTimeShown:6500,autoUpdateEnabled:false,buildAncestry:true,currentAutoUpdateInterval:20000,editTimeWindow:90,emptyUpdateTolerance:5,fastAutoUpdateInterval:20000,flaggedThreshold:1,localClockOffset:null,markItUp:{onShiftEnter:{keepDefault:false,replaceWith:"\n\n"},markupSet:[{name:"Bold",key:"B",closeWith:"*",openWith:"*"},{name:"Italic",key:"I",closeWith:"_",openWith:"_"},{name:"Strike through",key:"S",closeWith:"-",openWith:"-"},{name:"Spoilers",key:"F",openWith:"%(spoiler)",closeWith:"%"},{separator:"---------------"},{name:"Bulleted list",openWith:"* ",multiline:true},{name:"Numeric list",openWith:"# ",multiline:true},{separator:"---------------"},{name:"Picture",openWith:"![![Source:!:http://]!](",closeWith:")!"},{name:"Link",openWith:'"',closeWith:'(!(([![Title (Shown on hover)]!]))!)":[![Link:!:http://]!]',placeHolder:"Your text to link here..."},{separator:"---------------"},{name:"Quotes",openWith:"bq. "}],resizeHandle:false},maxIndentationDepth:30,offsetHeight:Math.floor(jQuery(window).height()*0.333),recommendedThreshold:1,renderChunkLength:200,renderTo:"#comments",scrollAnimationDuration:300,scrollBuffer:0,showAutoUpdateAlert:true,showAvatars:true,showSignatures:true,showImages:true,removeImages:false,slowAutoUpdateInterval:60000,sortMethod:"ancestry",startOnScroll:(Chorus.Environment.currentBreakpoint().index>1)},settings:{},initialize:function(b,a){this.stop();this.started=false;this.context={};this.settings=_.extend({},this.defaults,this.settings,a);this.collection=new Chorus.Comments.Collections.Comments([],{entryId:b});if(this.settings.renderTo){this.compileTemplates();this.view=new Chorus.Comments.Views.Main({el:this.settings.renderTo,collection:this.collection});this.view.render()}if(window.location.hash.match(/^#\d+$/)){this.start()}return this},initContext:function(a){this.context=a;this.settings.autoUpdateEnabled=this.settings.autoUpdateEnabled&&this.context.able_to_comment&&!this.context.comments_closed&&Chorus.Environment.currentBreakpoint().index>1;if(this.settings.autoUpdateEnabled){this.startAutoUpdate()}},start:function(){if(this.started){return}this.started=true;this.listenTo(this,"ajaxSuccess",this.ajaxSuccess);this.listenTo(this,"ajaxError",this.ajaxError);this.collection.load();this.trigger("start");return this},stop:function(){if(this.view){this.view.remove()}this.view=null;this.collection=null;this.started=false;this.trigger("stop");this.stopListening();return this},compileTemplates:function(){_.each(Chorus.Comments.Views,function(b){if(b.prototype.templateId){var a=jQuery("#"+b.prototype.templateId).html()||"";b.prototype.template=_.template(a)}})},scheduleAutoUpdate:function(b){if(!this.settings.autoUpdateEnabled){return}var a;if(b.emptyUpdateCount<this.settings.emptyUpdateTolerance){a=this.settings.fastAutoUpdateInterval}else{a=this.settings.slowAutoUpdateInterval}this.settings.currentAutoUpdateInterval=a;clearTimeout(this.autoUpdateTimeout);this.autoUpdateTimeout=setTimeout(function(){b.update()},a)},startAutoUpdate:function(){this.settings.autoUpdateEnabled=true;this.listenTo(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate);this.scheduleAutoUpdate(this.collection)},stopAutoUpdate:function(){this.settings.autoUpdateEnabled=false;this.stopListening(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate);clearTimeout(this.autoUpdateTimeout);this.autoUpdateTimeout=null},openModal:function(a){Chorus.EventDispatcher.publish("modal_open",{content:a})},closeModal:function(){Chorus.EventDispatcher.publish("modal_close")},ajaxSuccess:function(b,a,g,c){var d=Date.parse(g.getResponseHeader("Date"));var f=(new Date().valueOf()-d.valueOf())/1000;var e=this.settings.localClockOffset;if(_.isNumber(e)){this.settings.localClockOffset=(e+f)/2}else{this.settings.localClockOffset=f}},ajaxError:function(f,a,e,d){try{var b=JSON.parse(f.responseText);if(b.message&&this.settings.alertErrors){alert(b.message)}}catch(c){}}});Chorus.Comments.Mixins.Ajax={urlFor:function(b){var a=this.urls[b];if(a){a=a.replace(/:([^\/]+)/,_.bind(function(d,c){return(this instanceof Backbone.Model)?this.get(c):this[c]},this))}return a},ajax:function(e,b){var a=this.urlFor(e);if(!a){throw"ArgumentError: No url specified for action: "+e}var d=this;var c=_.extend({url:a,dataType:"json",context:this,timeout:Chorus.Comments.settings.ajaxTimeout},this.ajaxOptions||{},b);if(c.data&&_.isObject(c.data)&&c.type==="POST"){c.contentType="application/json";c.data=JSON.stringify(c.data);c.processData=false}c.error=function(h,f,g){if(b&&_.isFunction(b.error)){b.error.call(c.context,d,g)}d.trigger(e+"Error",d,g,h);Chorus.Comments.trigger("ajaxError",h,f,g,d)};c.success=function(g,f,h){if(b&&_.isFunction(b.success)){b.success.call(c.context,d,g)}d.trigger(e+"Success",d,g,h);Chorus.Comments.trigger("ajaxSuccess",g,f,h,d)};d.trigger(e+"Start",d);Chorus.Comments.trigger("ajaxStart",d);return jQuery.ajax(c)}};Chorus.Comments.Models.Comment=Backbone.Model.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{ajaxOptions:{type:"POST"},urls:{preview:"/comments/preview_comment",post:"/comments/post_comment",edit:"/comments/edit_comment/:id",hide:"/comments/hide_comment/:id",flag:"/comments/flag_comment/:id",unflag:"/comments/unflag_comment/:id",recommend:"/comments/recommend_comment/:id",destroy:"/comments/destroy_comment/:id",loadFlaggings:"/comments/ajax_comment_flags/:id",blockUser:"/comments/block_user/:id"},initialize:function(){if(Chorus.Comments.settings.buildAncestry&&(!this.get("ancestry")||!this.get("depth"))){this.buildAncestry()}this.listenTo(this,"change:id change:parent_id",this.buildAncestry);this.listenTo(this,"change:collapsed",this.collapseDescendants)},buildAncestry:function(){var c=function(e){e=e.toString();return e.length>=10?e:new Array(10-e.length+1).join("0")+e};var a=this.id?c(this.id):"preview";var b=this.parent();var d;if(b){a=b.get("ancestry")+"/"+a}d=a.split("/").length;d=Math.min(d,Chorus.Comments.settings.maxIndentationDepth);this.set({ancestry:a,depth:d},{silent:true})},user:function(){return this.collection.users.get(this.get("user_id"))||new Chorus.Comments.Models.User({display_name:this.get("username")||"anonymous"})},parent:function(){var a=this.get("parent_id");if(a){return this.collection.get(a)}else{return null}},ancestors:function(){if(!this.get("ancestry")){return[]}var a=this.get("ancestry").split("/");a.pop();return _.map(a,function(b){b=parseInt(b,10);return this.collection.get(b)},this)},descendants:function(){var a=new RegExp("^"+this.get("ancestry")+"/");return this.collection.filter(function(b){return a.test(b.get("ancestry"))})},matchesConditions:function(b){for(var a in b){if(b[a]!=this.get(a)){return false}}return true},findNeighbor:function(f,e,b){var g=this.collection.indexOf(this);var a=this.collection.length-1;var c=g;var d;if(a===0){return null}do{c=(b)?c-1:c+1;if(!e&&(c<0||c>a)){return null}else{if(c<0){c=a}else{if(c>a){c=0}}}d=this.collection.at(c);if(d&&d.matchesConditions(f)){return d}}while(c!==g);return null},prev:function(b,a){return this.findNeighbor(b,a,true)},next:function(b,a){return this.findNeighbor(b,a,false)},flaggings:function(){return this.collection.flaggings.where({flaggable_id:this.id})},isFlagged:function(){return this.get("bad_flags_count")>=Chorus.Comments.settings.flaggedThreshold},isRecommended:function(){return this.get("recommended_flags_count")>=Chorus.Comments.settings.recommendedThreshold},createFlagging:function(a){return this.collection.flaggings.add({flag_name:a,flaggable_id:this.id,user_id:Chorus.Comments.context.user_id,created_on:new Date()})},secondsSinceCreate:function(){var b=Chorus.Comments.settings.localClockOffset||0;var a=new Date().getTime()/1000;a=Math.round(a-b);return a-this.get("created_on_timestamp")},isEditable:function(){return this.get("user_id")===Chorus.Comments.context.user_id&&this.secondsSinceCreate()<Chorus.Comments.settings.editTimeWindow},isPreview:function(){return !this.id},toJSON:function(){var b=_.clone(this.attributes);var a;b.is_flagged=this.isFlagged();b.is_recommended=this.isRecommended();b.is_editable=this.isEditable();b.is_preview=this.isPreview();b.permalink=this.getAbsoluteURL("permalink");b.shortlink=this.getAbsoluteURL("shortlink");if(Chorus.Environment.currentBreakpoint().index<2){b.created_on=this.get("created_on_short")}else{b.created_on=this.get("created_on_long")}a=this.user();if(a){b.user=a.toJSON(true)}return b},getAbsoluteURL:function(a){return window.location.origin+this.get(a)},preview:function(){return this.ajax("preview",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(b,a){b.collection.users.add(a,{parse:true});b.set(a.comments[0])}})},post:function(){var a=this.get("body");if(a){this.set("rawBody",a)}return this.ajax("post",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(c,b){c.collection.users.add(b,{parse:true});c.set(b.comments[0]);c.collection.add(c)}})},edit:function(a){if(a.body){this.set("rawBody",a.body)}return this.ajax("edit",{data:{entry_id:this.collection.entryId,comment:a},success:function(c,b){c.set(b.comments[0])}})},hide:function(){var a={};var b=this.descendants();_.each(b,function(c){a[c.id]=c.get("hidden");c.set("hidden",true)});this.set("hidden",true);return this.ajax("hide",{error:function(c){c.set("hidden",false);_.each(b,function(d){d.set("hidden",a[d.id])})}})},unhide:function(){this.set("hidden",false);return this.ajax("hide",{error:function(a){a.set("hidden",true)}})},flag:function(b){var a=this.createFlagging("inappropriate");this.set({is_flagged_by_user:true,bad_flags_count:this.get("bad_flags_count")+1});return this.ajax("flag",{data:b,error:function(c){c.set({is_flagged_by_user:false,bad_flags_count:c.get("bad_flags_count")-1});c.collection.flaggings.remove(a)}})},unflag:function(){var a=this.flaggingsLoaded;var b=this.flaggings();this.flaggingsLoaded=false;this.collection.flaggings.remove(b);this.set({is_flagged_by_user:false,bad_flags_count:this.get("bad_flags_count")-1});return this.ajax("unflag",{error:function(c){c.set({is_flagged_by_user:true,bad_flags_count:c.get("bad_flags_count")+1});c.collection.flaggings.add(b);c.flaggingsLoaded=a}})},recommend:function(){var a=this.createFlagging("recommended");this.set({is_recommended_by_user:true,recommended_flags_count:(this.get("recommended_flags_count")||0)+1});return this.ajax("recommend",{error:function(b){b.set({is_recommended_by_user:false,recommended_flags_count:b.get("recommended_flags_count")-1});b.collection.flaggings.remove(a)}})},unrecommend:function(){var a=this.flaggings();this.collection.flaggings.remove(a);this.set({is_recommended_by_user:false,recommended_flags_count:this.get("recommended_flags_count")-1});return this.ajax("unflag",{error:function(b){b.set({is_recommended_by_user:true,recommended_flags_count:b.get("recommended_flags_count")+1});b.collection.flaggings.add(a)}})},destroy:function(){var a=this.collection;var b=this.descendants();a.remove(b);a.remove(this);return this.ajax("destroy",{error:function(c){a.add(c);a.add(b)}})},loadFlaggings:function(){return this.ajax("loadFlaggings",{type:"GET",success:function(b,a){b.collection.users.add(a,{parse:true,merge:true});b.collection.flaggings.add(a,{parse:true,merge:true});b.flaggingsLoaded=true}})},collapseDescendants:function(a,b){if(b){_.each(this.descendants(),function(d){if(!d.get("collapsedAncestorId")){d.set("collapsedAncestorId",this.id)}},this)}else{_.each(this.descendants(),function(d){if(d.get("collapsedAncestorId")===this.id){d.set("collapsedAncestorId",null)}},this)}},blockUser:function(){var a=this.user();var c=this.collection;var b=c.where({user_id:this.get("user_id")});c.remove(b);c.users.remove(a);return this.ajax("blockUser",{error:function(){c.users.add(a);c.add(b)}})}}));Chorus.Comments.Models.Flagging=Backbone.Model.extend({initialize:function(){this.set("created_on_timestamp",Math.round(new Date(this.get("created_on")).getTime()/1000))},user:function(){return this.collection.users.get(this.get("user_id"))},flaggable:function(){return this.collection.comments.get(this.get("flaggable_id"))},toJSON:function(){var c=_.clone(this.attributes);var a=this.user();var b=new Date(this.get("created_on")).toLocaleString();c.created_on=b;if(a){c.user=a.toJSON()}return c}});Chorus.Comments.Models.User=Backbone.Model.extend({initialize:function(){var b=this.get("author_profile");var c=this.get("network_membership");var a=this.get("membership");if(b){this.set({profile_image:this.get("author_profile").image_url,profile_url:this.get("author_profile").url})}else{if(c){this.set({profile_image:c.image_url,profile_url:c.url})}}if(a){this.set({inspect_user_url:a.inspect_user_url})}},isAuthor:function(){return Chorus.Comments.context.author_id===this.id},isContributor:function(){return _.indexOf(Chorus.Comments.context.contributor_ids,this.id)>-1},toJSON:function(){var a=_.clone(this.attributes);a.is_author=this.isAuthor();a.is_contributor=this.isContributor();return a}});Chorus.Comments.Collections.Comments=Backbone.Collection.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{model:Chorus.Comments.Models.Comment,urls:{load:"/comments/load_comments/:entryId",update:"/comments/ajax_comments_update/:entryId"},loaded:false,lastRequestId:0,emptyUpdateCount:0,initialize:function(b,a){this.entryId=a.entryId;this.users=new Chorus.Comments.Collections.Users();this.flaggings=new Chorus.Comments.Collections.Flaggings([],{users:this.users,comments:this});this.listenTo(this,"add",this.findCollapsedAncestor);return this},comparator:function(e,c){switch(Chorus.Comments.settings.sortMethod){case"ancestry":var f=e.get("ancestry");var d=c.get("ancestry");if(f<d){return -1}else{if(f>d){return 1}else{return 0}}case"forward-chron":if(e.get("created_on_timestamp")===c.get("created_on_timestamp")){return e.get("id")-c.get("id")}else{return e.get("created_on_timestamp")-c.get("created_on_timestamp")}case"reverse-chron":if(e.get("created_on_timestamp")===c.get("created_on_timestamp")){return c.get("id")-e.get("id")}else{return c.get("created_on_timestamp")-e.get("created_on_timestamp")}}},parse:function(a){return a.comments||[]},load:function(){return this.ajax("load",{timeout:null,data:_.extend({t:new Date().getTime()},Chorus.Comments.settings.ajaxParams),success:function(b,a){Chorus.Comments.initContext(a.context);b.loaded=true;b.lastId=a.last_id;b.lastVersion=a.last_version;b.users.reset(a,{parse:true});b.flaggings.reset(a,{parse:true});b.reset(a,{parse:true})}})},update:function(){this.lastRequestId+=1;return this.ajax("update",{data:_.extend({request_id:this.lastRequestId,last_id:this.lastId,last_version:this.lastVersion},Chorus.Comments.settings.ajaxParams),success:function(b,a){if(b.lastRequestId!==a.last_request_id){console.warn("Failed to update comments: updates arrived out of order");return}b.lastId=a.last_id;b.lastVersion=a.last_version;if(a.comments.length){b.emptyUpdateCount=0}else{b.emptyUpdateCount++}_.each(a.deleted_comment_ids,function(d){var c=b.get(d);if(c){b.remove(c.descendants());b.remove(c)}});b.users.add(a,{parse:true});b.add(a,{parse:true});b.flaggings.add(a,{parse:true})},error:function(b,a){b.emptyUpdateCount++}})},findCollapsedAncestor:function(b){var a=_.find(b.ancestors().reverse(),function(d){return d.get("collapsed")});if(a){b.set("collapsedAncestorId",a.id);a.trigger("change")}}}));Chorus.Comments.Collections.Flaggings=Backbone.Collection.extend({model:Chorus.Comments.Models.Flagging,initialize:function(b,a){this.users=a.users;this.comments=a.comments},parse:function(a){return a.flaggings||[]}});Chorus.Comments.Collections.Users=Backbone.Collection.extend({model:Chorus.Comments.Models.User,parse:function(b,a){return b.users||[]},current:function(){return this.get(Chorus.Comments.context.user_id)}});Chorus.Comments.Views.AccountActions=Backbone.View.extend({id:"",className:"",templateId:"comment-account-actions-template",render:function(){this.$el.html(this.template());this.trigger("render",this);return this}});Chorus.Comments.Views.AutoUpdateAlert=Backbone.View.extend({id:"autoupdate_info",templateId:"comment-auto-update-alert-template",events:{"click .close":"hide","click .go_to_comment":"goToComment"},initialize:function(a){this.listenTo(this.collection,"updateSuccess",this.show)},render:function(){this.$el.hide();this.trigger("render",this);return this},show:function(d,a){if(Chorus.Comments.settings.showAutoUpdateAlert===false){return}var c=[];_.each(a.comments,function(h){if(h.user_id!==Chorus.Comments.context.user_id){var e=d.get(h.id);var f=e.toJSON();var g=e.parent();if(g){f.parent=g.toJSON()}c.push(f)}});if(c.length===0){return}var b=this.template({comments:c,settings:Chorus.Comments.settings});this.$el.html(b).fadeIn(1000);setTimeout(_.bind(this.hide,this),Chorus.Comments.settings.autoUpdateAlertTimeShown)},hide:function(){this.$el.fadeOut(500);return false},goToComment:function(a){var b=a.currentTarget.getAttribute("data-comment-id");Chorus.Comments.trigger("activateComment",b);return false}});Chorus.Comments.Views.BaseForm=Backbone.View.extend({events:{"submit form":"submit","click .post_comment_button":"post","click .preview_comment_button":"preview","click .cancel_comment_button":"cancel","focusin textarea":"hideTouchTools","focusout textarea":"showTouchTools"},renderPreview:function(a){if(this.previewView){this.previewView.model=a}else{this.previewView=new Chorus.Comments.Views.Comment({model:a})}this.previewView.render().$el.prependTo(this.el);this.$(".preview-controls").show();this.$(".preview_comment_button").prop("disabled",false).val("Preview");return this},formData:function(){var a=this.$("form").serializeArray();var b={};_.each(a,function(c){b[c.name]=c.value});return b},submit:function(){if(this.previewView){this.post()}else{this.preview()}return false},post:function(){var b=this.$(".post_comment_button");b.prop("disabled",true).val(this.submitText+"ing...");var a=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});a.once("postSuccess",function(){this.cancel()},this);a.once("postError",function(){b.prop("disabled",false).val(this.submitText)},this);a.post();return false},preview:function(){var b=this.$(".preview_comment_button");b.prop("disabled",true).val("Previewing...");var a=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});a.once("previewSuccess",this.renderPreview,this);a.once("previewError",function(){b.prop("disabled",false).val("Preview")},this);a.preview();return false},remove:function(){if(this.previewView){this.previewView.remove();this.previewView=null}return Backbone.View.prototype.remove.call(this)},hideTouchTools:function(){if(typeof Chorus.Comments.view.touchTools!="undefined"){Chorus.Comments.view.touchTools.hide()}},showTouchTools:function(){if(typeof Chorus.Comments.view.touchTools!="undefined"){Chorus.Comments.view.touchTools.show()}}});Chorus.Comments.Views.Comment=Backbone.View.extend({templateId:"comment-template",events:{"click .reply_link":"reply","click .edit_link":"edit","click .flag_link":"toggleFlagged","click .rec_link":"toggleRecommended","click .delete_link":"destroy","click .hide_link":"toggleHidden","click .up_link":"activateParent","click .actions_toggle":"toggleActions","click .inspect_flags_link":"inspectFlags","click .inspect_user_link":"inspectUser","click .block_user_link":"blockUser","click .collapse_toggle":"toggleCollapsed","click .image_toggle .message":"toggleImage"},renderTriggers:["id","parent_id","title","body","user_id","signature","hidden","created_on_long","created_on_short","created_on_timestamp","recommended_flags_count","is_recommended_by_user","troll_flags_count","spam_flags_count","inappropriate_flags_count","bad_flags_count","is_flagged_by_user"],initialize:function(){this.listenTo(this.model,"change:"+this.renderTriggers.join(" change:"),this.render);this.listenTo(this.model,"change",this.regenerateWrapperClass);this.listenTo(this.model,"markRead",this.markCollapsedDescendantsRead);this.listenTo(this.model,"remove",this.remove);return this},className:function(){var d=this.model.toJSON();var c=Chorus.Comments.context;var b=[];var a=function(f,e){if(e){b.push(f)}else{b=_.without(b,f)}};if(this.el&&this.el.className){b=b.concat(this.el.className.split(" "))}a("citem",true);a("cdepth-"+d.depth,true);a("recommended",d.is_recommended);a("flagged",c.able_to_moderate&&d.is_flagged);a("new",d.is_new);a("hidden",d.hidden);a("obscured",d.obscured);a("collapsed",d.collapsed);a("collapsed-child",d.collapsedAncestorId);a("moderator",d.is_posted_by_moderator);a("preview",d.is_preview);return _.uniq(b).join(" ")},attributes:function(){return{id:this.model.id}},delegateEvents:function(){},hasProfilePicture:function(){return this.model.user().get("profile_image")&&Chorus.Environment.currentBreakpoint().index>=Chorus.Comments.settings.avatarBreakpointIndex&&Chorus.Comments.settings.showAvatars},render:function(){var a=this.model.toJSON();this.$el.html(this.template({view:this,context:Chorus.Comments.context,settings:Chorus.Comments.settings,comment:a}));if(this.model.isEditable()){this.updateEditCountdown()}if(Chorus.Comments.settings.removeImages){this.removeImages()}else{this.makeImagesHideable()}if(this.replyForm){this.$el.append(this.replyForm.el);this.replyForm.delegateEvents()}this.trigger("render",this);return this},makeImagesHideable:function(){var a=this.$(".cbody img");a.wrap('<span href="#" class="image_toggle"></span>').parent().toggleClass("hidden",!Chorus.Comments.settings.showImages).append('<span class="message"></span>');if(Util.canUseLocalStorage()){a.each(function(){var b=jQuery(this);if(localStorage.getItem(b.attr("src"))){b.parent().addClass("hidden")}})}},removeImages:function(){this.$(".cbody img").remove()},toggleImage:function(b){jQuery(b.currentTarget).parent().toggleClass("hidden");if(Util.canUseLocalStorage()){var c=jQuery(b.currentTarget).parent();var a=c.find("img").attr("src");c.hasClass("hidden")?localStorage.setItem(a,"hidden"):localStorage.removeItem(a)}return false},renderReplyCounts:function(){var c=this.model.descendants();var b=c.length;if(b>0){var a=_.filter(c,function(e){return e.get("is_new")}).length;var d=(b===1)?"1 reply":b+" replies";if(a>0){d+=", "+a+" new"}this.$(".reply_count").text(d)}},regenerateWrapperClass:function(){this.$el.attr("class",this.className())},updateEditCountdown:function(){var a=Chorus.Comments.settings.editTimeWindow-this.model.secondsSinceCreate();if(a>0){this.$(".countdown_timer").text(Math.round(a));this.$(".countdown_timer_bar").width(100*(a/Chorus.Comments.settings.editTimeWindow)+"%");setTimeout(_.bind(this.updateEditCountdown,this),1000)}else{this.$(".edit_link").remove();this.$(".countdown_timer").text("");this.$(".countdown_timer_bar").remove()}},reply:function(){if(!Chorus.Comments.context.user_id){Chorus.Auth.modal.open("login")}else{if(!Chorus.Comments.context.able_to_comment){var a=jQuery("#comment_tease, #comments .m-user-msg__account-action, #comments .m-user-msg__membership_required").offset();if(a){jQuery("html, body").animate({scrollTop:a.top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})}}else{if(!this.replyForm){this.replyForm=new Chorus.Comments.Views.ReplyForm({model:this.model,collection:this.model.collection});this.replyForm.renderTo(this.el);this.listenTo(this.replyForm,"cancel",function(){this.replyForm=null})}}}return false},edit:function(){this.$el.addClass("ui-state-editing");var a=new Chorus.Comments.Views.EditForm({model:this.model});a.render().$el.prependTo(this.el);a.once("cancel",function(){this.$el.removeClass("ui-state-editing")},this);return false},toggleHidden:function(){var b=this.model.get("hidden");var a=_.any(this.model.ancestors(),function(d){return d.get("hidden")});if(a){alert("You can't "+(b?"unhide":"hide")+" this comment, because its parents are already hidden.")}else{if(b){this.model.unhide()}else{this.model.hide()}}return false},destroy:function(){var a=confirm("You're about to delete this comment and all its replies. Are you sure?");if(a===true){this.model.destroy()}return false},blockUser:function(){var a=["Spam ban is to be used exclusively for obvious spam, and not for normal moderation of community members.","","This action will ban the user from all Chorus communities (not just this one) and delete their comments. It is not reversible."].join("\n");if(confirm(a)){if(prompt("Enter the word 'BAN' (all caps) to confirm.")=="BAN"){this.model.blockUser()}else{alert("Confirmation did not match.")}}return false},toggleActions:function(){this.$el.toggleClass("ui-state-tools-active");return false},toggleRecommended:function(){if(this.model.get("is_recommended_by_user")){this.model.unrecommend()}else{this.model.recommend()}return false},toggleFlagged:function(){if(this.model.get("is_flagged_by_user")){this.model.unflag()}else{new Chorus.Comments.Views.FlagDialog({model:this.model}).render()}return false},inspectFlags:function(){new Chorus.Comments.Views.InspectFlagsDialog({model:this.model}).render();return false},inspectUser:function(){var a=this.model.user();window.open(a.get("inspect_user_url"));return false},toggleCollapsed:function(){if(this.model.get("collapsed")){this.uncollapse()}else{this.collapse();this.renderReplyCounts()}return false},collapse:function(){this.model.set("collapsed",true)},uncollapse:function(){this.model.set("collapsed",false)},activate:function(){this.$el.addClass("active");jQuery("html, body").stop(true).animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})},activateParent:function(){var a=this.model.parent();if(a){Chorus.Comments.trigger("activateComment",a.id)}return false},deactivate:function(){this.$el.removeClass("active")},markCollapsedDescendantsRead:function(){if(this.model.get("collapsed")){_.each(this.model.descendants(),function(a){a.set("is_new",false)});this.renderReplyCounts()}}});Chorus.Comments.Views.CommentList=Backbone.View.extend({id:"comments_list",className:"comment_master_list",childSelector:".citem",childView:Chorus.Comments.Views.Comment,shortcuts:{"Shift+a":"markAllRead","Shift+c":"activatePrev",c:"activateNext",j:"activateNext",k:"activatePrev",x:"markRead",z:"markReadAndActivateNext",r:"replyToCurrent"},initialize:function(){this.childViews={};this.listenTo(this.collection,"loadSuccess",this.renderAll);this.listenTo(this.collection,"add",this.renderOne);this.listenTo(this.collection,"remove",this.removeOne);this.listenTo(this.collection,"loadSuccess add",this.renderEmbeds);this.listenTo(Chorus.Comments,"activateComment",this.activateId);this.listenTo(this,"renderAll",this.activateHash);_.each(this.shortcuts,function(b,a){shortcut.add(a,_.bind(this[b],this),{disable_in_input:true})},this)},render:function(){return this},delegateEvents:function(){_.each(this.childView.prototype.events,function(d,f){var e=f.match(/^(\S+)\s+(.+)$/);var c=e[1],a=e[2];var g=this.childViews;var b=this.childSelector;this.$el.on(c+".delegateEvents",b+" "+a,function(i){var j=jQuery(this).closest(b);var h=g[j.attr("id")];if(h){return h[d].call(h,i)}})},this);return Backbone.View.prototype.delegateEvents.call(this)},removeAll:function(){this.$el.empty();this.trigger("removeAll",this);this.childViews={};return this},removeOne:function(b){var a=this.childViews[b.id];if(a){a.remove()}delete this.childViews[b.id];this.trigger("removeOne",this,a,b);return this},renderAll:function(){var a=Chorus.Comments.settings;return this.renderPage(0,a.renderChunkLength)},renderPage:function(e,b){var c=Chorus.Comments.settings;var a=_.map(this.collection.slice(e,b),function(f){return this.renderOne(f,false).el},this);this.$el.append(a);this.trigger("renderPage",this,e,b);if(b<this.collection.length){e=b;b=Math.min(this.collection.length,e+Chorus.Comments.settings.renderChunkLength);var d=function(){this.renderPage(e,b)};setTimeout(_.bind(d,this),0)}else{this.trigger("renderAll",this)}return this},renderOne:function(f,e){var c=this.childViews[f.id]||new this.childView({model:f});this.childViews[f.id]=c.render();if(e){var b=this.collection.length;var a=this.collection.indexOf(f)+1;var d;while(!d&&a<b){d=this.collection.at(a++);d=d&&this.childViews[d.id]}if(d){d.$el.before(c.el)}else{this.$el.append(c.el)}this.trigger("renderOne",this,c,f)}return c},renderEmbeds:function(){if(window.twttr&&window.twttr.widgets&&_.isFunction(window.twttr.widgets.load)){window.twttr.widgets.load()}},activeModel:function(){return this.activeId?this.collection.get(this.activeId):null},activeView:function(){return this.activeId?this.childViews[this.activeId]:null},activateId:function(c){var b=this.activeView();var a=this.childViews[c];if(b){b.deactivate()}if(a){if(a.$el.hasClass("collapsed-child")){this.activateId(a.model.get("parent_id"))}else{a.activate();this.activeId=c}}return this},activateHash:function(){var a=window.location.hash.match(/^#(\d+)$/);if(a){setTimeout(_.bind(this.activateId,this,a[1]),1000)}},activateNeighbor:function(c){var a=this.activeModel();var b;if(a){b=a[c]({is_new:true},true)}else{b=(c==="next")?this.collection.first():this.collection.last();while(b&&!b.get("is_new")){b=b[c]()}}if(b){return this.activateId(b.id)}},activatePrev:function(){if(this.collection.loaded){this.activateNeighbor("prev")}else{this.loadThenRun("activatePrev")}},activateNext:function(){if(this.collection.loaded){this.activateNeighbor("next")}else{this.loadThenRun("activateNext")}},markRead:function(){var b=this.activeModel();var a=this.activeView();if(b){b.set("is_new",false);b.trigger("markRead")}if(a){a.deactivate()}},markAllRead:function(){_.each(this.collection.where({is_new:true}),function(a){a.set("is_new",false)})},markAllUnread:function(){this.collection.each(function(a){a.set("is_new",true)});if(!this.activeId){this.activeId=this.collection.first().id}},markReadAndActivateNext:function(){if(this.collection.loaded){this.markRead();this.activateNext()}else{this.loadThenRun("markReadAndActivateNext")}},replyToCurrent:function(){var a=this.activeView();if(a){a.reply()}},loadThenRun:function(a){jQuery("html, body").animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.animationDuration});if(!Chorus.Comments.settings.startOnScroll){Chorus.Comments.start()}this.listenToOnce(this.collection,"loadSuccess",this[a])}});Chorus.Comments.Views.CommentsClosedNotice=Backbone.View.extend({templateId:"comments-closed-notice-template",render:function(){this.$el.html(this.template());this.trigger("render",this);return this}});Chorus.Comments.Views.EditForm=Backbone.View.extend({className:"cedit cform",templateId:"comment-edit-form-template",events:{"submit form":"submit","click .post_edit_button":"submit","click .cancel_edit_button":"cancel"},render:function(){this.$el.html(this.template({comment:this.model.toJSON()}));this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);this.trigger("render",this);return this},formData:function(){var a=this.$("form").serializeArray();var b={};_.each(a,function(c){b[c.name]=c.value});return b},submit:function(){var a=this.$(".post_edit_button");a.prop("disabled",true).val("Saving...");this.model.once("editSuccess",function(){this.cancel()},this);this.model.once("editError",function(){a.prop("disabled",false).val("Save")},this);this.model.edit(this.formData());return false},cancel:function(){this.remove();this.trigger("cancel");return false}});Chorus.Comments.Views.FlagDialog=Backbone.View.extend({templateId:"comment-flag-dialog-template",events:{"submit form":"submit"},render:function(){var a=this.template({comment:this.model.toJSON()});Chorus.Comments.openModal(a);this.setElement("#comment_flag_modal");this.trigger("render",this);return this},submit:function(){this.model.flag(this.$("form").serialize());Chorus.Comments.closeModal();return false}});Chorus.Comments.Views.Footer=Backbone.View.extend({templateId:"comments-footer-template",render:function(){this.$el.html(this.template());this.trigger("render",this);return this}});Chorus.Comments.Views.FormattingGuide=Backbone.View.extend({id:"comment_formatting_guide",templateId:"comment-formatting-guide-template",render:function(){this.$el.html(this.template()).hide();this.trigger("render",this);return this}});Chorus.Comments.Views.Header=Backbone.View.extend({className:"comments-header ui-state-unloaded",templateId:"comments-header-template",events:{"click .show_comments_link":"loadComments","click .tips_link":"toggleTips","click .auto_update_alert_toggle":"toggleAutoUpdateAlert","click .touch_tools_toggle":"toggleTouchTools"},initialize:function(){this.listenTo(Chorus.Comments,"start",this.showLoadingIndicator);this.listenTo(this.collection,"loadSuccess",this.hideLoadingIndicator);this.listenTo(this.collection,"loadError",this.showLoadError);this.listenTo(this.collection,"loadSuccess",this.render);this.listenTo(this.collection,"updateSuccess",this.updateCount)},render:function(){this.$el.html(this.template({context:Chorus.Comments.context,settings:Chorus.Comments.settings}));this.trigger("render",this);return this},loadComments:function(){if(!!Chorus.EventDispatcher){Chorus.EventDispatcher.publish("loadComments")}Chorus.Comments.start();return false},toggleTips:function(){this.$el.toggleClass("ui-state-tips-active");return false},showLoadError:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-loading").addClass("ui-state-load-error")},showLoadingIndicator:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-load-error").addClass("ui-state-loading")},hideLoadingIndicator:function(){this.$el.removeClass("ui-state-unloaded").removeClass("ui-state-loading").removeClass("ui-state-load-error").addClass("ui-state-loaded")},updateCount:function(){this.$(".count").text(this.collection.length)},toggleAutoUpdateAlert:function(){var a=!Chorus.Comments.settings.showAutoUpdateAlert;Chorus.Comments.settings.showAutoUpdateAlert=a;this.$(".auto_update_alert_toggle").text(a?"Hide it!":"Show it!");return false},toggleTouchTools:function(){if(Chorus.Comments.view.touchTools){Chorus.Comments.view.touchTools.toggle()}return false}});Chorus.Comments.Views.InspectFlagsDialog=Backbone.View.extend({templateId:"comment-inspect-flags-dialog-template",render:function(){if(!this.model.flaggingsLoaded){this.model.once("loadFlaggingsSuccess",this.render,this);this.model.loadFlaggings();return this}var a=this.template({comment:this.model.toJSON(),flaggings:_.invoke(this.model.flaggings(),"toJSON")});Chorus.Comments.openModal(a);this.setElement("#inspect_flags_modal");this.trigger("render",this);return this}});Chorus.Comments.Views.MainForm=Chorus.Comments.Views.BaseForm.extend({id:"main_comment_form",className:"cform cform-main",templateId:"comment-main-form-template",submitText:"Post",events:function(){var a=_.clone(Chorus.Comments.Views.BaseForm.prototype.events);a["click #formatting_guide_links a"]="toggleFormattingGuide";return a},render:function(){this.$el.html(this.template({context:Chorus.Comments.context}));this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);var a=new Chorus.Comments.Views.FormattingGuide();a.render().$el.appendTo(this.el);this.trigger("render",this);return this},cancel:function(){if(this.previewView){this.previewView.remove();this.previewView=null}this.$(".preview-controls").hide();this.$(".post_comment_button").prop("disabled",false).val("Post");this.$(".preview_comment_button").prop("disabled",false).val("Preview");this.$("form").get(0).reset();this.trigger("cancel");return false},toggleFormattingGuide:function(a){jQuery(a.target).hide().siblings().show();jQuery("#comment_formatting_guide").slideToggle();return false}});Chorus.Comments.Views.Main=Backbone.View.extend({events:{"click .spoiler":"toggleSpoiler"},initialize:function(){var a=Chorus.Comments.Views;this.header=new a.Header({collection:this.collection});this.commentList=new a.CommentList({collection:this.collection});this.footer=new a.Footer();if(Chorus.Comments.settings.startOnScroll){this.pollScrollPosition()}this.listenTo(this.collection,"loadSuccess",this.renderWithContext);this.listenTo(this.collection,"loadError",this.renderError)},render:function(){this.$el.append(this.header.render().el,this.commentList.render().el);this.trigger("render",this);return this},remove:function(){this.header.remove();this.commentList.remove();this.footer.remove();if(this.mainForm){this.mainForm.remove()}if(this.touchTools){this.touchTools.remove()}if(this.autoUpdateAlert){this.autoUpdateAlert.remove()}this.$el.remove();return this},renderWithContext:function(){var e=Chorus.Comments.Views;var c=Chorus.Comments.context;var d=Chorus.Comments.settings;var a=false;if(c.comments_closed){this.mainForm=new e.CommentsClosedNotice();a=true}else{if(c.able_to_comment){this.mainForm=new e.MainForm({collection:this.collection})}else{this.mainForm=new Backbone.View();a=true}}var b=new e.AccountActions();this.$el.append(b.render().el,this.mainForm.render().el,this.footer.render().el);if(a&&!_.isUndefined(Chorus.Auth)){Chorus.Auth.init()}if(c.able_to_comment&&!c.comments_closed&&Chorus.Environment.touch()){this.touchTools=new e.TouchTools({collection:this.collection});this.touchTools.render().$el.appendTo(this.el)}if(d.autoUpdateEnabled&&d.showAutoUpdateAlert){this.autoUpdateAlert=new e.AutoUpdateAlert({collection:this.collection});this.autoUpdateAlert.render().$el.appendTo(this.el)}this.trigger("render",this);return this},renderError:function(){this.$el.append('<h2 class="comments-load-error-msg">There was an error loading the comments. Please try again later</h2>')},pollScrollPosition:function(){var c=this.$el;var d=jQuery(window);var a=Chorus.Comments.settings.scrollBuffer;var b=function(){if(c.offset().top-d.scrollTop()-d.height()-a<0){Chorus.Comments.start()}};b=_.throttle(b,200);b();d.on("scroll",b);Chorus.Comments.once("start",function(){d.off("scroll",b)})},toggleSpoiler:function(a){jQuery(a.target).toggleClass("reveal_spoiler");return false}});Chorus.Comments.Views.ReplyForm=Chorus.Comments.Views.BaseForm.extend({className:"cform",templateId:"comment-reply-form-template",submitText:"Reply",renderTo:function(a){this.$el.html(this.template({context:Chorus.Comments.context,comment:this.model.toJSON()}));this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);this.$el.appendTo(a);this.$("[autofocus]:first").focus();this.trigger("render",this);return this},cancel:function(){this.remove();this.trigger("cancel");return false}});Chorus.Comments.Views.TouchTools=Backbone.View.extend({id:"comment_touch_tools",templateId:"comment-touch-tools-template",events:{"click .close":"toggle","click .refresh":"refresh","click .next":"activateNext","click .mark":"markAllRead"},initialize:function(){this.listenTo(this.collection,"updateSuccess updateError",this.stopLoading)},render:function(){this.$el.html(this.template());this.trigger("render",this);return this},toggle:function(){this.$el.toggle();return false},refresh:function(){this.$el.addClass("loading");this.collection.update();return false},stopLoading:function(){this.$el.removeClass("loading")},activateNext:function(){Chorus.Comments.view.commentList.markReadAndActivateNext();return false},markAllRead:function(){Chorus.Comments.view.commentList.markAllRead();return false},show:function(){this.$el.show();return false},hide:function(){this.$el.hide();return false}});var Chorus=Chorus||{};Chorus.RemoteEntryAdminPermissions=(function(g){var e={loaded:false};var d="remote-admin-entry-id";var c="/remote_entry_admin/check_permissions";var h="*[data-"+d+"]";function b(){var i=g(h).map(function(j,l){return g(l).data(d)});i=_.uniq(_.compact(i)).sort();if(i.length){g.ajax({method:"GET",url:c,dataType:"json",data:{entry_ids:i.join(":")},success:a,error:f})}}function a(i){e=_.extend(e,{loaded:true},i);Chorus.EventDispatcher.publish("permissionsLoaded",_.clone(e),true)}function f(){if(console){console.error("there was an error loading the permissions object from the client controls")}}return{init:function(){if(Chorus.Context.logged_in===false){return}b()},getPermissions:function(){return e}}})(jQuery);jQuery(Chorus.RemoteEntryAdminPermissions.init);var Chorus=Chorus||{};Chorus.EntryAdminControls=(function(e){var n="remote-admin-entry-id";var g="remote-admin-entry-type";var h="*[data-"+g+"]";var b="/remote_entry_admin/pane";var p="/remote_entry_admin/actions_modal";var r="/remote_entry_admin/image_sizes_modal";var q=_.template('<a href="[%= data.edit_url%]">Edit Entry</a>');function o(v){e(h).each(function(w,A){var B=e(A);var x=B.data(n);var y=v[x];if(y&&y.permitted===true){var z=B.data(g);if(z==="button"){B.append(q(y));B.on("click",m)}if(z==="pane"){B.load(b,{entry_id:x},function(){B.on("mouseenter",a);B.on("mouseleave",f)})}}});e("body").on("click","#inspect-images-link",d);e("body").on("click","#hide-entry-link",t)}function c(v){Chorus.EventDispatcher.publish("modal_open",{url:p,data:{entry_id:v}})}function j(v){return"*[data-"+n+'="'+v+'"][data-'+g+'="pane"]'}function l(v){e(j(v)).addClass("is-active")}function s(v){e(j(v)).removeClass("is-active")}function i(v){var w=v.text()==="Hidden";v.text((w)?"Unhiding":"Hiding");e.ajax({method:"POST",url:v.attr("href"),dataType:"text",complete:function(){location.reload(true)}})}function u(v){o(v)}function m(w){if(Util.UserAgentProfiler.isMobile()===false){var v=e(w.delegateTarget).data(n);if(e(j(v)).length<1){w.preventDefault();c(v)}}}function a(v){l(e(v.delegateTarget).data(n))}function f(v){s(e(v.delegateTarget).data(n))}function d(v){v.preventDefault();Chorus.EventDispatcher.publish("modal_open",{url:r+"/"+e(v.target).data(n)})}function t(v){v.preventDefault();i(e(v.target))}return{init:function(){if(Chorus.Context.logged_in===false){return}Chorus.EventDispatcher.subscribe("permissionsLoaded",u)}}})(jQuery);jQuery(Chorus.EntryAdminControls.init);var Chorus=Chorus||{};Chorus.RemoteHeadlineEdit=(function(i){var p="remote-admin-entry-id";var c="remote-headline-edit";var o="promo_headline_field";var b="/remote_entry_admin/update_title";var t=['<form action="[%= data.headline_save_url %]" data-'+p+'="[%= data.entry_id %]" data-'+c+'= "[%= data.field %]" method="post" class="m-inline-headline-edit__form">','<label for="new_value">[%= data.field.replace(/_/g, " ")  %]</label>','<input type="text" name="new_value" value="[%= data.current_headline %]" />','<input type="hidden" name="entry_id" value="[%= data.entry_id %]" />','<input type="hidden" name="field" value="[%= data.field %]" />','[% if (data.include_buttons === true) { %]<input type="submit" value="Save" class="p-button"/>','<input type="button" value="cancel" class="p-button" /> [% } %]',"</form>"].join("");var q=_.template(t);function r(x){var w=x.data("remote-headline-promo-headine");var y=i(q({current_headline:x.text(),headline_save_url:b,field:x.data(c),entry_id:x.data(p),include_buttons:(w)?false:true}));x.after(y);x.addClass("is-editing");y.on("change",'input[type="text"]',f);y.on("click",'input[type="submit"]',l);y.on("click",'input[value="cancel"]',s);y.on("submit",function(z){z.preventDefault()});if(w){var v=i(q({current_headline:w,headline_save_url:b,field:o,entry_id:x.data(p),include_buttons:true}));y.after(v);v.on("change",'input[type="text"]',f);v.on("click",'input[type="submit"]',l);v.on("click",'input[value="cancel"]',s);v.on("submit",function(z){z.preventDefault()})}}function m(v,w){if(w===o){w="title"}return i("*[data-"+c+'="'+w+'"][data-'+p+'="'+v+'"]')}function a(v){m(v.data(p),v.data(c)).removeClass("is-editing");v.siblings(".m-inline-headline-edit__form").remove();v.remove()}function d(v){v.find('input[type="text"], input[type="submit"]').prop("disabled",true)}function h(v){v.find('input[type="text"], input[type="submit"]').prop("disabled",false)}function g(v){v.data("remote-headline-edit-submit",true)}function n(v){v.add(v.siblings(".m-inline-headline-edit__form")).each(function(w,A){var z=i(A);if(z.data("remote-headline-edit-submit")===true){var x=z.find('input[name="entry_id"]').val();var y=z.find('input[name="new_value"]').val();var B=z.find('input[name="field"]').val();d(z);i.ajax({method:"POST",url:b,dataType:"json",data:{entry_id:x,field:B,value:y},success:function(C){if(B===o){m(x,"title").data("remote-headline-promo-headine",y)}else{m(x,B).text(y)}a(z);alert(Util.stringToTitleCase(B.replace(/_/g," "))+" saved!")},error:function(D,C){h(z);alert("There was an error recieving data from the server.")}})}})}function e(v){i("*[data-"+c+"]").each(function(w,z){var x=i(z);var y=v[x.data(p)];if(y&&y.permitted===true){x.addClass("is-editable");x.on("click",j)}})}function j(w){w.preventDefault();var v=i(w.delegateTarget);if(v.hasClass("is-editing")===false){r(v)}}function s(v){v.preventDefault();a(i(v.delegateTarget))}function l(v){v.preventDefault();n(i(v.delegateTarget))}function f(v){g(i(v.delegateTarget))}function u(v){if(v.is_headline_editor===true){e(v)}}return{init:function(){if(Chorus.Context.logged_in===false||Util.UserAgentProfiler.isMobile()===true){return}Chorus.EventDispatcher.subscribe("permissionsLoaded",u)}}})(jQuery);jQuery(Chorus.RemoteHeadlineEdit.init);var Chorus=Chorus||{};Chorus.HubAdminMenu=(function(a){return{init:function(){jQuery(function(b){b("#hub-admin-menu").click(function(){b(this).toggleClass("is-open")})})}}})(jQuery);jQuery(function(){Chorus.HubAdminMenu.init()});var Util=Util||{};Util.UserAgentProfiler=(function(){var m=("ontouchstart" in window)||(window.DocumentTouch&&document instanceof DocumentTouch)||(navigator.msMaxTouchPoints>0),b=window.innerWidth,c=window.navigator.userAgent,o=(m&&b<728)||(window.location.href.indexOf("mobile=true")>0),h=m&&b>=728,e=!o&&!h,p=/(iPad|iPhone|iPod)/g.test(c),j=(p&&/OS\s(7|6_1_4)/g.test(c)),l=/Android/g.test(c),q=false,a=(o)?"mobile":(h)?"tablet":"desktop";if(c.indexOf("Android")>0){var f=c.split(";");for(var d=0,g=f.length;d<g;d++){if(f[d].indexOf("Android")>0){var n=f[d].split(" ");if(parseInt(n[n.length-1].split(".")[0])<3){q=true;break}}}}return{screenWidth:function(){return b},profile:function(){return a},isTablet:function(){return h},isMobile:function(){return o},isDesktop:function(){return e},isAndroid:function(){return l},isAndroidLt3:function(){return q},isIOS:function(){return p},isIOS7:function(){return j},deviceTypeForAds:function(){return this.profile()},browserWidthForAds:function(){return Chorus.Environment.currentBreakpoint().name}}})();var Kicksend={mailcheck:{threshold:3,defaultDomains:"yahoo.com google.com hotmail.com gmail.com me.com aol.com mac.com live.com comcast.net googlemail.com msn.com hotmail.co.uk yahoo.co.uk facebook.com verizon.net sbcglobal.net att.net gmx.com mail.com".split(" "),defaultTopLevelDomains:"co.uk com net org info edu gov mil".split(" "),run:function(d){d.domains=d.domains||Kicksend.mailcheck.defaultDomains;d.topLevelDomains=d.topLevelDomains||Kicksend.mailcheck.defaultTopLevelDomains;d.distanceFunction=d.distanceFunction||Kicksend.sift3Distance;var c=Kicksend.mailcheck.suggest(encodeURI(d.email),d.domains,d.topLevelDomains,d.distanceFunction);c?d.suggested&&d.suggested(c):d.empty&&d.empty()},suggest:function(f,e,h,g){f=f.toLowerCase();f=this.splitEmail(f);if(e=this.findClosestDomain(f.domain,e,g)){if(e!=f.domain){return{address:f.address,domain:e,full:f.address+"@"+e}}}else{if(h=this.findClosestDomain(f.topLevelDomain,h),f.domain&&h&&h!=f.topLevelDomain){return e=f.domain,e=e.substring(0,e.lastIndexOf(f.topLevelDomain))+h,{address:f.address,domain:e,full:f.address+"@"+e}}}return !1},findClosestDomain:function(i,h,o){var n,m=99,j=null;if(!i||!h){return !1}o||(o=this.sift3Distance);for(var l=0;l<h.length;l++){if(i===h[l]){return i}n=o(i,h[l]);n<m&&(m=n,j=h[l])}return m<=this.threshold&&null!==j?j:!1},sift3Distance:function(i,h){if(null==i||0===i.length){return null==h||0===h.length?0:h.length}if(null==h||0===h.length){return i.length}for(var o=0,n=0,m=0,j=0;o+n<i.length&&o+m<h.length;){if(i.charAt(o+n)==h.charAt(o+m)){j++}else{for(var l=m=n=0;5>l;l++){if(o+l<i.length&&i.charAt(o+l)==h.charAt(o)){n=l;break}if(o+l<h.length&&i.charAt(o)==h.charAt(o+l)){m=l;break}}}o++}return(i.length+h.length)/2-j},splitEmail:function(g){g=g.split("@");if(2>g.length){return !1}for(var f=0;f<g.length;f++){if(""===g[f]){return !1}}var j=g.pop(),i=j.split("."),h="";if(0==i.length){return !1}if(1==i.length){h=i[0]}else{for(f=1;f<i.length;f++){h+=i[f]+"."}2<=i.length&&(h=h.substring(0,h.length-1))}return{topLevelDomain:h,domain:j,address:g.join("@")}}}};window.jQuery&&function(b){b.fn.mailcheck=function(f){var i=this;if(f.suggested){var h=f.suggested;f.suggested=function(c){h(i,c)}}if(f.empty){var g=f.empty;f.empty=function(){g.call(null,i)}}f.email=this.val();Kicksend.mailcheck.run(f)}}(jQuery);var Chorus=Chorus||{};Chorus.Auth=(function(a){return{config:function(b){this.element={wrapper:a(".m-auth-modal__wrapper"),modal:a(".m-auth-modal"),close:a(".m-auth-modal__close"),body:a(".m-auth-modal__body"),form:a(".m-auth-modal__form"),loginTable:a(".m-auth-modal__login-table"),loadingMsg:a("#chorus-auth-loading-message")};this.authTriggers={data:a("[data-chorus-auth]"),goTo:a("[data-chorus-auth-goto]"),auto:a("[data-chorus-auth-auto]"),facebook:a('[data-chorus-auth-login="facebook"]'),openId:a('[data-chorus-auth-login="openid"]'),twitter:a('[data-chorus-auth-login="twitter"]'),yahoo:a('[data-chorus-auth-login="yahoo"]'),password:a("#chorus-auth-password")};this.globals={serializedForm:"",bindOnceExecuted:false,dispatcherDefined:(!!Chorus&&!!Chorus.EventDispatcher)};this.openModalClass="-has-open-auth-modal";this.networkUrl=this.element.modal.data("chorus-auth-network-url");if(Chorus.Auth.helpers.noCorsSupport()){this.networkUrl=Chorus.Auth.helpers.httpNetworkUrl()}b()},defaultAjaxOptions:{xhrFields:{withCredentials:true}},init:function(){this.config(function(){if(!Chorus.Auth.networkUrl){return}if(window.addEventListener){window.addEventListener("message",function(b){var d=Chorus.Auth.helpers.httpNetworkUrl();if(b.origin===d&&b.data.trim()[0]==="{"){var c=JSON.parse(b.data);if(c.is_from_chorus_auth){Chorus.Auth.actions.callbacks.chorusAuth(c)}}},false)}Chorus.Auth.events.bindOnce();Chorus.Auth.helpers.placeholderPolyfill();Chorus.Auth.helpers.checkForAutoLoad()})},events:{bindOnce:function(){if(Chorus.Auth.globals.bindOnceExecuted===false){if(!Util.UserAgentProfiler.isMobile()){Chorus.Auth.authTriggers.data.on("click",Chorus.Auth.modal.open)}if(Chorus.Auth.globals.dispatcherDefined){Chorus.EventDispatcher.subscribe("modal_closed_by_modaljs",Chorus.Auth.modal.forceClose)}Chorus.Auth.globals.bindOnceExecuted=true}},bind:function(){Chorus.Auth.authTriggers.goTo.on("click",Chorus.Auth.modal.goTo);Chorus.Auth.element.wrapper.on("click",Chorus.Auth.modal.close);Chorus.Auth.element.modal.find(Chorus.Auth.element.close).on("click",Chorus.Auth.modal.close);Chorus.Auth.authTriggers.password.on("submit",Chorus.Auth.actions.login.password);_.each(["rec-migrate","rec-migrate-author"],function(i){var l=Chorus.Auth.modal.goTo(i,true);l.find("#rec-migrate-already").on("click",function(m){m.preventDefault();Chorus.Auth.modal.goTo("rec-migrate-login")});l.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);l.find('[name="user[username]"]').on("focus blur",Chorus.Auth.actions.validate.username);l.find('[name="user[password]"]').on("blur",Chorus.Auth.actions.validate.password)});var b=Chorus.Auth.modal.goTo("rec-migrate-login",true);b.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var g=Chorus.Auth.modal.goTo("forgot",true);g.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var f=Chorus.Auth.modal.goTo("forgot-username",true);f.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);Chorus.Auth.authTriggers.facebook.on("click",function(i){Chorus.Auth.actions.login.facebook(i)});Chorus.Auth.authTriggers.twitter.on("click",function(i){Chorus.Auth.actions.login.twitter(i)});Chorus.Auth.authTriggers.yahoo.on("click",function(i){Chorus.Auth.actions.login.yahoo(i)});Chorus.Auth.authTriggers.openId.on("click",function(i){Chorus.Auth.actions.showOpenIdForm(i)});Chorus.Auth.element.form.filter(".openid").on("submit",function(i){Chorus.Auth.actions.login.openId(i)});var j=["join","register-join"];for(var d=0;d<j.length;d++){var e=Chorus.Auth.modal.goTo(j[d],true);e.find('input[type="checkbox"]').on("change",Chorus.Auth.actions.validate.checkboxEnablesForm);e.find("form").on("submit",Chorus.Auth.actions.form.startSubmission)}Chorus.Auth.modal.goTo("umbel-permissions",true).find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var h=Chorus.Auth.modal.goTo("third-party-register",true);h.find('[name="user[username]"]').on("focus",Chorus.Auth.actions.validate.validationEnablesForm);h.find('[name="user[username]"]').on("focus blur",Chorus.Auth.actions.validate.username);h.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);Chorus.Auth.modal.goTo("captcha",true).find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var c=Chorus.Auth.modal.goTo("register",true);c.find('[name="user[username]"]').on("blur",Chorus.Auth.actions.validate.username);c.find('[name="user[password]"]').on("blur",Chorus.Auth.actions.validate.password);c.find('[name="user[email]"]').on("blur",Chorus.Auth.actions.validate.email);c.find('[name="user[email]"]').on("blur",Chorus.Auth.actions.validate.suggestEmail);c.find("form").on("submit",Chorus.Auth.actions.form.startSubmission)}},actions:{validate:{email:function(c){var b=Chorus.Auth.actions.validate.getInputContext(c);b.errorId="email";if(!_.isEmpty(b.value)){Chorus.Auth.actions.validate.testAgainstJSON("email_valid",{email:b.value},b)}else{b.status.removeClass("error success");Chorus.Auth.actions.validate.errors.clear(b)}},suggestEmail:function(c){var b=Chorus.Auth.actions.validate.getInputContext(c);b.errorId="suggest-email";a(b.input).mailcheck({suggested:function(e,d){Chorus.Auth.actions.validate.errors.show(b,"Did you mean "+d.full+"?")},empty:function(d){Chorus.Auth.actions.validate.errors.clear(b)}})},username:function(b){var c=Chorus.Auth.actions.validate.getInputContext(b);c.errorId="username";if(!_.isEmpty(c.value)&&c.value!=c.input.attr("placeholder")){Chorus.Auth.actions.validate.testAgainstJSON("username_available",{username:c.value},c)}else{c.status.removeClass("error success")}},password:function(d){var c=Chorus.Auth.actions.validate.getInputContext(d);c.errorId="password";if(!_.isEmpty(c.value)){var b=(c.value.length>=6&&c.value.match(/\d/)&&c.value.match(/\d/).length&&c.value.match(/[a-z]/i)&&c.value.match(/[a-z]/i).length)?true:false;Chorus.Auth.actions.validate.addCheckOrX(b,c)}else{c.status.removeClass("error success")}},checkboxEnablesForm:function(d){var c=Chorus.Auth.actions.validate.getInputContext(d);c.errorId="checkbox";var b=c.modalObj.find('[type="submit"]');if(c.input.is(":checked")){b.removeAttr("disabled")}else{b.attr("disabled",true)}},getInputContext:function(f){var c=a(f.target);var d=c.parents(Chorus.Auth.element.body.selector);var b={input:c,status:c.parent(),value:c.val(),modal:d.data("chorus-auth-modal"),modalObj:d,errorMsg:c.data("error-msg"),errorEl:c.parent().find("h6")};return b},testAgainstJSON:function(b,d,c){a.getJSON(Chorus.Auth.networkUrl+"/chorus_auth/"+b+".json?callback=?",d).success(function(e){Chorus.Auth.actions.validate.addCheckOrX(e,c)})},addCheckOrX:function(c,b){if(c.available||(_.isBoolean(c)&&c)){b.status.addClass("success");b.status.removeClass("error");Chorus.Auth.actions.validate.errors.clear(b)}else{b.status.addClass("error");b.status.removeClass("success");if(_.isUndefined(c.message)){Chorus.Auth.actions.validate.errors.show(b)}else{Chorus.Auth.actions.validate.errors.show(b,c.message)}}},isFormValid:function(c){var b=a(c.target);var f=b.find("fieldset").filter("[data-chorus-auth-validate]").length;var d=b.find("fieldset").filter("[data-chorus-auth-validate].success").length;return(f===d)},errors:{show:function(c,d){var b=(_.isUndefined(d))?c.errorMsg:d;if(!c.status.find("#"+c.errorId).length){a("<h6/>").appendTo(c.status).attr("id",c.errorId).text(b);if(!c.status.hasClass("error")){c.status.addClass("error");c.status.removeClass("success")}}},clear:function(b){b.status.find("#"+b.errorId).remove()}}},form:{startSubmission:function(d){var b=a(d.target).parents(Chorus.Auth.element.body.selector);switch(b.data("chorus-auth-modal")){case"forgot":Chorus.Auth.modal.spinner("Sending...");var c=a(d.target).find("[name='email']").val();a.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/request_password_reset.json",data:{email:c},dataType:"json",success:function(g){var e=Chorus.Auth.modal.goTo("forgot-result",true);e.find("p.error").text("");e.find("p.success").text(g.message);if(g.message_type==="success"){e.find('[ data-chorus-auth-goto="forgot"]').hide();e.find(".third-party").hide()}Chorus.Auth.modal.goTo("forgot-result")},error:function(j,g,i){var h=JSON.parse(j.responseText);var e=Chorus.Auth.modal.goTo("forgot-result",true);e.find("p.success").text("");e.find("p.error").text(data.message);Chorus.Auth.modal.goTo("forgot-result")}},Chorus.Auth.defaultAjaxOptions));break;case"forgot-username":Chorus.Auth.modal.spinner("Sending...");var c=a(d.target).find("[name='email']").val();a.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/request_username_retrieval.json",data:{email:c},dataType:"json",success:function(g){var e=Chorus.Auth.modal.goTo("forgot-username-result",true);e.find("p.error").text("");e.find("p.success").text(g.message);if(g.message_type==="success"){e.find('[ data-chorus-auth-goto="forgot-username"]').hide();e.find(".third-party").hide()}Chorus.Auth.modal.goTo("forgot-username-result")},error:function(j,g,i){var h=JSON.parse(j.responseText);var e=Chorus.Auth.modal.goTo("forgot-username-result",true);e.find("p.success").text("");e.find("p.error").text(data.message);Chorus.Auth.modal.goTo("forgot-username-result")}},Chorus.Auth.defaultAjaxOptions));break;case"join":Chorus.Auth.actions.form.submitJoin();break;case"register-join":if(Chorus.Auth.isCaptchaRequired){Chorus.Auth.modal.goTo("captcha")}else{Chorus.Auth.actions.form.completeSubmission()}break;case"umbel-permissions":Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.modal.goTo("third-party-register");break;case"rec-migrate":case"rec-migrate-author":if(Chorus.Auth.actions.validate.isFormValid(d)){Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.isCaptchaRequired=false;if(Chorus.Auth.modal.goTo("register-join",true).length){Chorus.Auth.modal.goTo("register-join")}else{Chorus.Auth.actions.form.completeSubmission()}}break;case"rec-migrate-login":d.preventDefault();Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.actions.login.recLinkChorus(d);break;case"third-party-register":if(Chorus.Auth.actions.validate.isFormValid(d)){Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.isCaptchaRequired=false;if(Chorus.Auth.modal.goTo("register-join",true).length){Chorus.Auth.modal.goTo("register-join")}else{if(Chorus.Auth.modal.goTo("rec-migrate",true).length){Chorus.Auth.actions.login.recLinkChorus(d)}else{Chorus.Auth.actions.form.completeSubmission()}}}break;case"captcha":Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.actions.form.completeSubmission(Chorus.Auth.actions.captcha.error);break;case"register":if(Chorus.Auth.actions.validate.isFormValid(d)){Chorus.Auth.provider="password";Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.actions.captcha.init("chorus-auth-register-recaptcha");var f=a(d.target).find("[name='user[username]']").val();Chorus.Auth.modal.goTo("captcha",true).find("span.username").text(f);Chorus.Auth.isCaptchaRequired=true;if(Chorus.Auth.modal.goTo("register-join",true).length){Chorus.Auth.modal.goTo("register-join")}else{Chorus.Auth.modal.goTo("captcha")}}break}d.preventDefault()},completeSubmission:function(b){a.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/register.json",data:Chorus.Auth.globals.serializedForm,dataType:"json",success:function(c){Chorus.Auth.actions.login.completeLogin("Register")},error:function(f,c,e){var d=JSON.parse(f.responseText);b(d.message)}},Chorus.Auth.defaultAjaxOptions));Chorus.Auth.modal.spinner("Registering");return false},submitJoin:function(){var b=Chorus.Auth.networkUrl+"/chorus_auth/join_community.json";if(!!Chorus.Context.community_id){b=b+"?community_id="+Chorus.Context.community_id}a.ajax(_.extend({type:"post",url:b,dataType:"json",success:function(c){window.location.reload()},error:function(f,c,e){var d=JSON.parse(f.responseText);console.log(d.message)}},Chorus.Auth.defaultAjaxOptions));Chorus.Auth.modal.spinner("Registering");return false},serialize:function(b){if(!_.isEmpty(Chorus.Auth.globals.serializedForm)){Chorus.Auth.globals.serializedForm+="&"}Chorus.Auth.globals.serializedForm+=a(b).serialize()}},captcha:{init:function(b){a(".m-auth-modal__captcha-container").html("");a.ajax(_.extend({dataType:"html",url:Chorus.Auth.networkUrl+"/chorus_auth/recaptcha",success:function(c){a("#"+b).html(c);a.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){Recaptcha.destroy();Recaptcha.create("6LcgS98SAAAAAJLeEKGYuZxRROAovJl-ltyOgAC4",b,{theme:"custom"});var d=setInterval(function(){if(a(".m-auth-modal__recaptcha #recaptcha_image img").length){a(".m-auth-modal__recaptcha #recaptcha_image").removeAttr("style").find("img").removeAttr("width height");clearInterval(d)}},500)})}},Chorus.Auth.defaultAjaxOptions))},error:function(b){Recaptcha.reload();Chorus.Auth.modal.goTo("captcha",true).find("p.error").text(b);Chorus.Auth.modal.goTo("captcha")}},callbacks:{thirdParty:function(f,d,b){var e=Chorus.Auth.modal.goTo("third-party-register",true);if(!_.isUndefined(d)){var c=e.find('[name="user[username]"]');c.val(d);c.focus()}if(!_.isUndefined(b)){e.find(".m-auth-modal__avatar").attr("src",b)}},chorusAuth:function(c){if(c.logged_in){Chorus.Auth.actions.login.completeLogin("Login")}else{if(!_.isUndefined(c.error)){var b=Chorus.Auth.modal.goTo("register",true);b.find("p.error").text(c.error);Chorus.Auth.modal.goTo("register")}else{if(typeof ga==="function"){ga("send","event","SimpleAuth","Start Registration",c.provider)}else{if(typeof _gaq==="object"){_gaq.push(["_trackEvent","SimpleAuth","Start Registration",c.provider])}}Chorus.Auth.actions.callbacks.thirdParty(c.provider,c.username,c.profile_image_url);if(c.provider==="facebook"){Chorus.Auth.modal.goTo("umbel-permissions")}else{Chorus.Auth.modal.goTo("third-party-register")}}}}},login:{yahoo:function(b){Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_yahoo_auth");Chorus.Auth.provider="yahoo";b.preventDefault()},openId:function(c){var b=a(c.target).find("[name='openid']").val();Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_openid_auth?openid_url="+b);Chorus.Auth.provider="open_id";c.preventDefault()},twitter:function(c){var b=Chorus.Auth.networkUrl+"/chorus_auth/initiate_twitter_auth";Chorus.Auth.actions.openAuthWindow(b);Chorus.Auth.provider="twitter";c.preventDefault()},facebook:function(b){Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_facebook_auth");Chorus.Auth.provider="facebook";b.preventDefault()},gplus:function(b){Chorus.Auth.provider="google_plus";if(b.code&&b["g-oauth-window"]){Chorus.Auth.modal.spinner("Authenticating");a.ajax(_.extend({type:"POST",url:Chorus.Auth.networkUrl+"/chorus_auth/finalize_google_plus_auth.json?",data:{code:b.code},success:function(c){Chorus.Auth.actions.callbacks.chorusAuth(c)},dataType:"json"},Chorus.Auth.defaultAjaxOptions))}},recLinkChorus:function(c){var b=a(c.target);a.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/rec_link_chorus.json",data:Chorus.Auth.globals.serializedForm,dataType:"json",success:function(d){if(d.logged_in){Chorus.Auth.actions.login.completeLogin("Login")}else{if(typeof d.message!=="undefined"){b.find("p.error").text(d.message)}Chorus.Auth.modal.goTo("rec-migrate-login")}},error:function(g,d,f){var e=JSON.parse(g.responseText)}},Chorus.Auth.defaultAjaxOptions));Chorus.Auth.modal.spinner("Registering");return false},password:function(c){var b=a(c.target);var d=function(e){Chorus.Auth.provider="password";if(e.logged_in){Chorus.Auth.actions.login.completeLogin("Login")}else{if(typeof e.next_action!=="undefined"){Chorus.Auth.modal.goTo(e.next_action);return}if(e.captcha_required){Chorus.Auth.actions.captcha.init("chorus-auth-login-recaptcha")}if(typeof e.message!=="undefined"){b.find("p.error").text(e.message)}Chorus.Auth.modal.goTo("login")}};a.ajax(_.extend({type:"POST",url:Chorus.Auth.networkUrl+"/chorus_auth/initiate_password_auth.json",data:b.serialize(),success:d,dataType:"json"},Chorus.Auth.defaultAjaxOptions));Chorus.Auth.modal.spinner("Logging in...");c.preventDefault()},completeLogin:function(b){if(Chorus.Auth.networkUrl.indexOf("sbnation.com")>0){ga("send","event","SimpleAuth",b,Chorus.Auth.provider)}else{_gaq.push(["_trackEvent","SimpleAuth",b,Chorus.Auth.provider])}setTimeout(function(){window.location.reload()},100)}},openAuthWindow:function(c){Chorus.Auth.modal.spinner("Authenticating");var b=window.open(c,"_blank","height=450,width=800,menubar=yes,status=yes,scrollbars=yes,resizable=yes,titlebar=yes,toolbar=no,menubar=yes,location=yes");if(!b){alert("welp, window blocked")}},resetLoginOptions:function(){Chorus.Auth.element.loginTable.each(function(){a(this).find("tr").not(":first").addClass("other")});Chorus.Auth.element.form.filter(".openid").hide()},showOpenIdForm:function(d){var b=a(d.target);var c=b.parents(Chorus.Auth.element.body.selector);c.find(Chorus.Auth.element.form).filter(".openid").toggle();d.preventDefault()}},modal:{open:function(d){var b=(_.isObject(d))?a(this).data("chorus-auth"):d;if(Chorus.Auth.helpers.noCorsSupport()&&Chorus.Auth.helpers.notOnNetworkDomain()){var f=Chorus.Auth.helpers.httpNetworkUrl();var c=window.location.href.split("?")[0];window.location.href=f+"/login?return_to="+c}else{Chorus.Auth.element.modal.find('[data-chorus-auth-modal="'+b+'"]').show();if(Chorus.Auth.globals.dispatcherDefined){Chorus.EventDispatcher.publish("modal_open",{content:Chorus.Auth.element.modal})}}if(_.isObject(d)){d.preventDefault()}Chorus.Auth.events.bind()},forceClose:function(){a("body").removeClass(Chorus.Auth.openModalClass);Chorus.Auth.element.wrapper.hide();Chorus.Auth.element.modal.find("[data-chorus-auth-modal]").hide();Chorus.Auth.actions.resetLoginOptions()},close:function(b){if(b.target===this){a("body").removeClass(Chorus.Auth.openModalClass);Chorus.Auth.element.wrapper.hide();Chorus.Auth.element.modal.find("[data-chorus-auth-modal]").hide();Chorus.Auth.actions.resetLoginOptions();b.preventDefault()}},goTo:function(d,b){var f=(_.isObject(d))?a(this).data("chorus-auth-goto"):d;var c=Chorus.Auth.element.body.filter('[data-chorus-auth-modal="'+f+'"]');if(_.isUndefined(b)){Chorus.Auth.element.body.filter(":visible").hide();c.show()}else{return c}if(_.isObject(d)){d.preventDefault()}},spinner:function(b){Chorus.Auth.element.loadingMsg.text(b);Chorus.Auth.modal.goTo("spinner")},moveIntoView:function(){var b=a(window).scrollTop();Chorus.Auth.element.modal.css("top",b)}},helpers:{placeholderPolyfill:function(){var b=document.createElement("input");if("placeholder" in b){return}else{Chorus.Auth.element.modal.find("[placeholder]").focus(function(){var c=a(this);if(c.val()===c.attr("placeholder")){c.val("");c.removeClass("placeholder")}}).blur(function(){var c=a(this);if(c.val()===""||c.val()===c.attr("placeholder")){c.addClass("placeholder");c.val(c.attr("placeholder"))}}).blur()}},checkForAutoLoad:function(){if(Chorus.Auth.authTriggers.auto.length===1){var b=Chorus.Auth.authTriggers.auto.eq(0).data("chorus-auth-auto");Chorus.Auth.modal.open(b)}},httpNetworkUrl:function(){if(Chorus.Auth.networkUrl==null){return null}else{return Chorus.Auth.networkUrl.replace(/^https:\/\//,"http://")}},noCorsSupport:function(){return window.navigator.userAgent.match(/MSIE (6|7|8|9)/)},notOnNetworkDomain:function(){return window.location.href.indexOf(Chorus.Auth.helpers.httpNetworkUrl())!==0}}}})(jQuery);jQuery(function(){Chorus.Auth.init()});
